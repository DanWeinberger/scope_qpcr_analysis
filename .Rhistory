e3$social_activity_type[e3$recent_social_activities=='No'] <- 'No'
e3$frequency_child_contacts <- as.character(e3$frequency_child_contacts)
e3$frequency_child_contacts[e3$contact_children=='No'] <- 'No contact'
e3$piab_pos <- NA
e3$piab_pos[e3$piab >=40 & !is.na(e3$piab)] <- 0
e3$piab_pos[e3$piab <40 & !is.na(e3$piab)] <- 1
e3$piab_pos <- as.factor(e3$piab_pos)
e3$smoke_dic <- NA
e3$smoke_dic[grep('Yes',e3$current_smoke)] <- 1
e3$smoke_dic[grep('No',e3$current_smoke)] <- 0
e3$pneu_vax_dic <- NA
e3$pneu_vax_dic[grep('Yes',e3$pneu_vax)] <- 1
e3$pneu_vax_dic[grep('No',e3$pneu_vax)] <- 0
e3$pneu_vax_date[e3$pneu_vax_date=='N/A'] <- NA
e3$education <- tolower(e3$education)
e3$height <- gsub(' ', '', e3$height)
## export
id.ages <- unique(e3[,c('ID','AGE')])
id.ages <- id.ages[!is.na(id.ages$AGE),]
exp1 <- e3[,c('ID','time','piab', 'lyta','Household','MRN_cleaned', 'education','ethnicity',"hh_relationship"  ,        "relationship_duration","pneu_vax_dic" ,"pneu_vax_date" ,"weight", "height","pos_covid_past" ,          "pos_covid_date","smoke_dic", "contact_children" ,
"age_child_contacts"  ,     "frequency_child_contacts" ,"time_day_child_contacts" )]
baseline.chars <- exp1[,c('ID','Household', 'education','ethnicity',"hh_relationship"  ,        "relationship_duration","pneu_vax_dic" ,"pneu_vax_date" ,"weight", "height","pos_covid_past" ,          "pos_covid_date","smoke_dic")]
baseline.chars <- baseline.chars %>%
group_by(ID) %>%
mutate(smoke_dic= max(smoke_dic, na.rm=T))
baseline.chars <- baseline.chars %>%
group_by(ID) %>%
mutate(repN=row_number())
baseline.chars <- baseline.chars[baseline.chars$repN==1,]
baseline.chars$repN <- NULL
exp2 <- merge(id.ages, exp1[c('ID','time','piab', 'lyta',"contact_children" ,
"age_child_contacts"  ,     "frequency_child_contacts" ,"time_day_child_contacts")], by='ID', all.y=T)
exp3 <- merge(exp2,baseline.chars, by='ID', all.x=T )
exp3 <- exp3[order(exp3$ID, exp3$time),]
write.csv(exp3,'./Data/Confidential/export_pfizer.csv')
e3$month <- month(e3$visit_date_cleaned)
e3$contact_children[is.na(e3$contact_children) | e3$contact_children=='NA'] <- 'missing'
e3$child_contact <- 9999
e3$child_contact[e3$contact_children=='Yes'] <- 1
e3$child_contact[e3$contact_children=='No'] <- 0
e3$child_contact_u12m <- 0
e3$child_contact_u12m[grep('<12 m', e3$age_child_contacts)] <- 1
e3$child_contact_u12m[is.na(e3$age_child_contacts) & e3$contact_children!='No'] <- 9999
e3$child_contact_13_23m <- 0
e3$child_contact_13_23m[grep('13-23 mo', e3$age_child_contacts)] <- 1
e3$child_contact_13_23m[is.na(e3$age_child_contacts) & e3$contact_children!='No'] <- 9999
e3$child_contact_24_59m <- 0
e3$child_contact_24_59m[grep('24-59 months', e3$age_child_contacts)] <- 1
e3$child_contact_24_59m[is.na(e3$age_child_contacts) & e3$contact_children!='No'] <- 9999
e3$child_contact_5_10y <- 0
e3$child_contact_5_10y[grep('5-10 years', e3$age_child_contacts)] <- 1
e3$child_contact_5_10y[is.na(e3$age_child_contacts) & e3$contact_children!='No'] <- 9999
e3$child_contact_over10y <- 0
e3$child_contact_over10y[grep('>10 years', e3$age_child_contacts)] <-1
e3$child_contact_over10y[is.na(e3$age_child_contacts) & e3$contact_children!='No'] <- 9999
e3$activities <- 0
e3$activities[e3$recent_social_activities=='No'] <- 0
e3$activities[e3$recent_social_activities=='Yes'] <- 1
e3$activities[is.na(e3$social_activity_type)] <- 9999
e3$activity_family <- 0
e3$activity_family[e3$social_activity_type=='Activities with family'] <- 1
e3$activity_family[is.na(e3$social_activity_type)] <- 9999
e3$activity_friends <- 0
e3$activity_friends[e3$social_activity_type=='Activities with friends'] <- 1
e3$activity_friends[is.na(e3$social_activity_type)] <- 9999
e3$activity_community_center <- 0
e3$activity_community_center[e3$social_activity_type=='Activities at community centers'] <- 1
e3$activity_community_center[is.na(e3$social_activity_type)] <- 9999
e3$acitivity_fitness <- 0
e3$acitivity_fitness[e3$social_activity_type=='Fitness activities'] <- 1
e3$acitivity_fitness[is.na(e3$social_activity_type)] <- 9999
actitivity_summary <- e3 %>%
group_by(ID) %>%
summarize(soc_activity= max(activities, na.rm=T) ,
soc_activity_family= max(activity_family, na.rm=T) ,
soc_activity_friend= max(activity_friends, na.rm=T) ,
soc_activity_comm_ctr= max(activity_community_center, na.rm=T) ,
soc_activity_fitness= max(acitivity_fitness, na.rm=T)
) %>%
ungroup() %>%
summarize(freq_activity=mean(soc_activity, na.rm=T), N_activity=sum(soc_activity, na.rm=T),
freq_family=mean(soc_activity_family, na.rm=T),N_activity_family=sum(soc_activity_family, na.rm=T),
freq_friend=mean(soc_activity_friend, na.rm=T),N_activity_friends=sum(soc_activity_friend, na.rm=T),
freq_comm_ctr=mean(soc_activity_comm_ctr, na.rm=T),N_activity_comm_ctr=sum(soc_activity_comm_ctr, na.rm=T),
freq_fitness=mean(soc_activity_fitness, na.rm=T),N_activity_fitness=sum(soc_activity_fitness, na.rm=T)
)
out.list <- list('actitivity_summary_s1'=actitivity_summary, 'survey_and_pcr_s1'=e3, 'contacts_wide_s1'=q3.c)
return(out.list)
}
s2_surv <- read.csv('./Data/confidential/Season_2_Surveys/Uptodat Fortnightly_Wyllie_DATA_2022-07-21_1314 .csv') %>%
rename(scope_id=participant_id,
child_contact=child_contact_2weeks,
child_contact_u12m=child_contact_age___1,
child_contact_13_23m=child_contact_age___2,
child_contact_24_59m=child_contact_age___3,
child_contact_5_10y=child_contact_age___4,
child_contact_over10y=child_contact_age___5,
activity_community_center=activities_describe___1,
activity_friends=activities_describe___2,
activity_family=activities_describe___3,
acitivity_fitness=activities_describe___4,
activity_other=activities_describe___5
) %>%
mutate(ID = paste0('S2_',gsub("\\..*","",scope_id)) , time=visit_number)
##Clean S2 surveys
library(dplyr)
clean_s2_surveys <- function(){
s2_surv <- read.csv('./Data/confidential/Season_2_Surveys/Uptodat Fortnightly_Wyllie_DATA_2022-07-21_1314 .csv') %>%
rename(scope_id=participant_id,
child_contact=child_contact_2weeks,
child_contact_u12m=child_contact_age___1,
child_contact_13_23m=child_contact_age___2,
child_contact_24_59m=child_contact_age___3,
child_contact_5_10y=child_contact_age___4,
child_contact_over10y=child_contact_age___5,
activity_community_center=activities_describe___1,
activity_friends=activities_describe___2,
activity_family=activities_describe___3,
acitivity_fitness=activities_describe___4,
activity_other=activities_describe___5
) %>%
mutate(ID = paste0('S2_',gsub("\\..*","",scope_id)) , time=visit_number)
table(s2_surv$visit_number)
d1.ds <- readRDS( './data/PCR_compiled.rds')
s2_pcr <- d1.ds[grep('S2', d1.ds$ID),]
s2_a <- merge(s2_pcr, s2_surv, by=c('ID','time'), all=T) %>%
mutate(piab_pos = 1*(piab<40))
N_surveys <- dcast(s2_a[c('ID','time','child_contact')], ID~time, fun.aggregate = length)
s2_a <- s2_a %>%
filter(!is.na(time))
s2_a$child_contact[is.na(s2_a$child_contact)] <- 9999
s2_a$child_contact[is.infinite(s2_a$child_contact)] <- 9999
s2a$child_contact_u12m[is.na(s2a$child_contact_u12m)] <-9999
s2a$child_contact_13_23m[is.na(s2a$child_contact_13_23m)] <-9999
s2a$child_contact_24_59m[is.na(s2a$child_contact_24_59m)] <-9999
s2a$child_contact_5_10y[is.na(s2a$child_contact_5_10y)] <-9999
s2a$child_contact_over10y[is.na(s2a$child_contact_over10y)] <-9999
N_contacts <- dcast(s2_a[c('ID','time','child_contact')], ID~time, fun.aggregate = max, na.rm=T, fill=9999)
out.list <- list('survey_and_pcr_s2'=s2_a,'contacts_wide_s2'=N_contacts)
return(out.list)
}
knitr::opts_chunk$set(echo = FALSE)
library(readxl)
library(reshape2)
library(dplyr)
library(stringr)
library(pheatmap)
library(RColorBrewer)
library(cowplot)
library(gridExtra)
library(ggplotify)
library(table1)
library(lubridate)
library(patchwork)
library(msm)
library(gee)
source('heat.fun.R')
source('heat.fun.contact.R')
source('./R/clean_pcr.R')
source('./R/clean_s1_surveys.R')
source('./R/clean_s2_surveys.R')
clean_pcr <- clean_pcr()
plot(clean_pcr$pcr_summary_long$lyta, clean_pcr$pcr_summary_long$piab, xlim= c(45,0), ylim=c(45,0), xlab='lytA', ylab='piaB', bty='l')
abline(a=0, b=1)
abline(h=40, v=40, col='gray', lty=2)
piab.plot <- heat.fun(target='piab')
# breakslist<-seq(15,45,by=1)
#
# cols1 <- colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist))
#
# p1 <- ggplot(d1.ds, aes(time, HH_order, fill= piab)) +
#   geom_tile() +
#   scale_fill_viridis_c(option = "B", direction = -1) +
#
#   theme_classic()+
#   ylab('Serotype tested')+
#    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#   facet_wrap(~Household, ncol=3)+
#   theme(
#   strip.text.x = element_blank()
# )
# p1
lyta.plot <- heat.fun(target='lyta')
c1.m.m <- melt(clean_pcr$pcr_summary[,c('Target','ID','Sample','ct_pos2','Household') ],
id.vars=c('Target','ID','Sample','Household'))
c1.m.c <- dcast(c1.m.m, ID + Household + Sample  ~Target, fun.aggregate = min, fill=999)
#N people
N.id <- length(unique(c1.m.c$ID))
N.id
#N households
N.hh<- length(unique(c1.m.c$Household))
N.hh
#N samples
nrow(c1.m.c)
#length(unique(c1.m.c$Sample[c1.m$Target=='piab']))
#length(unique(c1.m.c$Sample[c1.m$Target=='lyta']))
#N positive
sum(c1.m.c$piab<40 )
sum(c1.m.c$piab<40  &c1.m.c$lyta>=40)
sum(c1.m.c$piab<40  &c1.m.c$lyta<40)
#% positive
sum(c1.m.c$piab<40 )/nrow(c1.m.c)
#N positive lytA
sum(c1.m.c$lyta<40 )
sum(c1.m.c$lyta<40 )/nrow(c1.m.c)
#Count N people with piaB positives by IDs
c1.m.spl.id <- split(c1.m.c, c1.m.c$ID)
N_pos_people <- sum(sapply(c1.m.spl.id, function(x){
min(x$piab) <40
}
))
N_pos_people
N_pos_people/N.id
#Count N HH with piab positives by IDs
c1.m.spl.id <- split(c1.m.c, c1.m.c$Household)
n_pos_hh <- sum(sapply(c1.m.spl.id, function(x){
min(x$piab) <40
}
))
n_pos_hh
n_pos_hh/N.hh
# ## Ave age
# age1 <- read_excel('./Data/confidential/AGE Scope Participants samples pick-up 06-15-2021.xlsx', skip=1)
# names(age1)[1] <- 'ID'
# age1 <- age1[ which(age1$ID %in% unique(c1.m.c$ID)),]
# mean(age1$AGE)
# range(age1$AGE)
s1_data <- clean_s1_surveys()
s2_data <- clean_s2_surveys()
##Clean S2 surveys
library(dplyr)
clean_s2_surveys <- function(){
s2_surv <- read.csv('./Data/confidential/Season_2_Surveys/Uptodat Fortnightly_Wyllie_DATA_2022-07-21_1314 .csv') %>%
rename(scope_id=participant_id,
child_contact=child_contact_2weeks,
child_contact_u12m=child_contact_age___1,
child_contact_13_23m=child_contact_age___2,
child_contact_24_59m=child_contact_age___3,
child_contact_5_10y=child_contact_age___4,
child_contact_over10y=child_contact_age___5,
activity_community_center=activities_describe___1,
activity_friends=activities_describe___2,
activity_family=activities_describe___3,
acitivity_fitness=activities_describe___4,
activity_other=activities_describe___5
) %>%
mutate(ID = paste0('S2_',gsub("\\..*","",scope_id)) , time=visit_number)
table(s2_surv$visit_number)
d1.ds <- readRDS( './data/PCR_compiled.rds')
s2_pcr <- d1.ds[grep('S2', d1.ds$ID),]
s2_a <- merge(s2_pcr, s2_surv, by=c('ID','time'), all=T) %>%
mutate(piab_pos = 1*(piab<40))
N_surveys <- dcast(s2_a[c('ID','time','child_contact')], ID~time, fun.aggregate = length)
s2_a <- s2_a %>%
filter(!is.na(time))
s2_a$child_contact[is.na(s2_a$child_contact)] <- 9999
s2_a$child_contact[is.infinite(s2_a$child_contact)] <- 9999
s2_a$child_contact_u12m[is.na(s2_a$child_contact_u12m)] <-9999
s2_a$child_contact_13_23m[is.na(s2_a$child_contact_13_23m)] <-9999
s2_a$child_contact_24_59m[is.na(s2_a$child_contact_24_59m)] <-9999
s2_a$child_contact_5_10y[is.na(s2_a$child_contact_5_10y)] <-9999
s2_a$child_contact_over10y[is.na(s2_a$child_contact_over10y)] <-9999
N_contacts <- dcast(s2_a[c('ID','time','child_contact')], ID~time, fun.aggregate = max, na.rm=T, fill=9999)
out.list <- list('survey_and_pcr_s2'=s2_a,'contacts_wide_s2'=N_contacts)
return(out.list)
}
s2_data <- clean_s2_surveys()
s1 <- s1_data$survey_and_pcr_s1 %>%
select(ID, time, Household, lyta, piab,activities, activity_family, activity_friends, activity_community_center, acitivity_fitness,child_contact,child_contact_u12m,child_contact_13_23m,child_contact_24_59m ,child_contact_5_10y,child_contact_over10y )
s2 <- s2_data$survey_and_pcr_s2  %>%
select(ID, time, Household, lyta, piab,activities, activity_family, activity_friends, activity_community_center, acitivity_fitness,child_contact, child_contact_u12m,child_contact_13_23m,child_contact_24_59m ,child_contact_5_10y,child_contact_over10y )
ds.c <- bind_rows(s1, s2)
ds.c$piab_pos <- 1*(ds.c$piab<45)
prop.table(table(ds.c$child_contact, ds.c$piab_pos), margin=1)
prop.table(table(ds.c$child_contact_u12m, ds.c$piab_pos), margin=1)
prop.table(table(ds.c$child_contact_13_23m, ds.c$piab_pos), margin=1)
prop.table(table(ds.c$child_contact_24_59m, ds.c$piab_pos), margin=1)
prop.table(table(ds.c$child_contact_5_10y, ds.c$piab_pos), margin=1)
prop.table(table(ds.c$child_contact_over10y, ds.c$piab_pos), margin=1)
mod_s2 <- glm(piab_pos ~ child_contact_u12m + child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y, family='binomial', data=ds.c )
summary(mod_s2)
str_extract("L0_123_abc", "[^_]+")
ds.c <- bind_rows(s1, s2) %>%
mutate(season= str_extract(ID, "[^_]+"))
unique(ds.c)
ds.c %>%
group_by(season) %>%
summarize(prevalence= mean(piab_pos))
ds.c <- bind_rows(s1, s2) %>%
mutate(season= str_extract(ID, "[^_]+"),
piab_pos=1*(ds.c$piab<45))
ds.c %>%
group_by(season) %>%
summarize(prevalence= mean(piab_pos))
ds.c %>%
group_by(season) %>%
summarize(prevalence= mean(piab_pos, na.rm=T))
ds.c %>%
group_by(season) %>%
summarize(prevalence= mean(piab_pos, na.rm=T), N_pos=sum(piab_pos, na.rm=T))
ds.c %>%
group_by(season) %>%
summarize(prevalence= mean(piab_pos, na.rm=T), N_pos=sum(piab_pos, na.rm=T), n_test=n())
ds.c$s37/579
37/579
ds.c %>%
group_by(season) %>%
summarize(pct_child_contact= mean(child_contact, na.rm=T),  n_test=n())
ds.c %>%
group_by(season) %>%
filter(child_contact %in% 0,1) %>%
summarize(pct_child_contact= mean(child_contact, na.rm=T),  n_test=n())
ds.c %>%
group_by(season) %>%
filter(child_contact %in% c(0,1)) %>%
summarize(pct_child_contact= mean(child_contact, na.rm=T),  n_test=n())
ds.c %>%
group_by(season) %>%
filter(child_contact %in% c(0,1)) %>%
summarize(pct_child_contact= mean(child_contact, na.rm=T),
pct_child_contact_u12m= mean(child_contact_u12m, na.rm=T),
pct_child_contact_u13_23m= mean(child_contact_13_23m, na.rm=T),
pct_child_contact_u12m= mean(child_contact_u12m, na.rm=T),
pct_child_contact_24_5m= mean(child_contact_24_59m, na.rm=T),
pct_child_contact_5_10y= mean(child_contact_5_10y, na.rm=T),
n_test=n())
mod_s2 <- glm(piab_pos ~ child_contact_u12m + child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y +season, family='binomial', data=ds.c )
summary(mod_s2)
mod_s2 <- glm(piab_pos ~ child_contact_u12m + child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y , family='binomial', data=ds.c )
summary(mod_s2)
View(ds.c)
fisher.test(ds.c$piab_pos, ds.c$child_contact)
fisher.test(ds.c$piab_pos, ds.c$child_contact_u12m)
fisher.test(ds.c$piab_pos, ds.c$child_contact_13_23m)
prop.table(table(ds.c$child_contact, ds.c$piab_pos), margin=1)
fisher.test(ds.c$piab_pos, ds.c$child_contact)
prop.table(table(ds.c$child_contact_u12m, ds.c$piab_pos), margin=1)
fisher.test(ds.c$piab_pos, ds.c$child_contact_u12m)
prop.table(table(ds.c$child_contact_13_23m, ds.c$piab_pos), margin=1)
fisher.test(ds.c$piab_pos, ds.c$child_contact_13_23m)
prop.table(table(ds.c$child_contact_24_59m, ds.c$piab_pos), margin=1)
fisher.test(ds.c$piab_pos, ds.c$child_contact_24_59m)
prop.table(table(ds.c$child_contact_5_10y, ds.c$piab_pos), margin=1)
fisher.test(ds.c$piab_pos, ds.c$child_contact_5_10y)
prop.table(table(ds.c$child_contact_over10y, ds.c$piab_pos), margin=1)
fisher.test(ds.c$piab_pos, ds.c$child_contact_over10y)
mod_s2 <- glm(piab_pos ~ child_contact_u12m + child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y , family='binomial', data=ds.c )
summary(mod_s2)
heat.fun.contact(ds=s1_data$contacts_wide_s1)
heat.fun.contact(ds=s2_data$contacts_wide_s2)
hist(age1$AGE, main='Distribution of ages', xlab='Age(y)')
mod.df <- ds.c[ds.c$child_contact_13_23m!='Not answered',]
mod1.gee <- gee(piab_pos ~ child_contact_u12m+ child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y,id=mod.df$ID, data=mod.df, family=binomial(link='log'), corstr="exchangeable")
names(ds.c)
View(ds.c)
mod.df <- ds.c[ds.c$child_contact_13_23m!=9999,]
mod1.gee <- gee(piab_pos ~ child_contact_u12m+ child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y,id=mod.df$ID, data=mod.df, family=binomial(link='log'), corstr="exchangeable")
mod.df <- ds.c[ds.c$child_contact_13_23m!=9999 & !is.na(piab_pos),]
mod.df <- ds.c[ds.c$child_contact_13_23m!=9999 & !is.na(ds.c$iab_pos),]
mod1.gee <- gee(piab_pos ~ child_contact_u12m+ child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y,id=mod.df$ID, data=mod.df, family=binomial(link='log'), corstr="exchangeable")
mod1.gee <- gee(piab_pos ~ child_contact_u12my,id=mod.df$ID, data=mod.df, family=binomial(link='log'), corstr="exchangeable")
mod1.gee <- gee(piab_pos ~ 1,id=mod.df$ID, data=mod.df, family=binomial(link='log'), corstr="exchangeable")
str(mod.df$ID)
str(mod.df$ID)
str(mod.df)
mod.df <- ds.c[ds.c$child_contact_13_23m!=9999 & !is.na(ds.c$piab_pos),]
mod1.gee <- gee(piab_pos ~ child_contact_u12m+ child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y,id=mod.df$ID, data=mod.df, family=binomial(link='log'), corstr="exchangeable")
View(mod.df)
mod.df <- ds.c %>%
filter(child_contact_13_23m!=9999 & !is.na(piab_pos))
mod1.gee <- gee(piab_pos ~ child_contact_u12m+ child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y,id=mod.df$ID, data=mod.df, family=binomial(link='log'), corstr="exchangeable")
mod1.gee <- gee(piab_pos ~ child_contact_u12m+ child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y,id=mod.df$ID, data=mod.df, family=binomial(link='log'), corstr="exchangeable")
mod1.gee <- gee(piab_pos ~ 1,id=mod.df$ID, data=mod.df, family=binomial(link='log'), corstr="exchangeable")
str(mod.df)
mod.df <- ds.c %>%
filter(child_contact_13_23m!=9999 & !is.na(piab_pos)) %>%
mutate(ID=as.factor(ID))
mod1.gee <- gee(piab_pos ~ child_contact_u12m+ child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y,id=mod.df$ID, data=mod.df, family=binomial(link='log'), corstr="exchangeable")
summary(mod1.gee)
coefs <-mod1.gee$coefficients
coef.lcl <- coefs - 1.96 * sqrt(diag(mod1.gee$naive.variance))
coef.ucl <- coefs + 1.96 * sqrt(diag(mod1.gee$naive.variance))
plot(1:5,coefs[-1])
arrows(1:5, y0=coef.lcl[-1], y1=coef.ucl[-1])
abline(h=0)
mod.df <- ds.c %>%
filter(child_contact_13_23m!=9999 & !is.na(piab_pos)) %>%
mutate(ID=as.factor(ID))
l1 <- mod.df
l1$day <- 0
l1$day[l1$time==2] <- 14
l1$day[l1$time==3] <- 14*2
l1$day[l1$time==4] <- 14*3
l1$day[l1$time==5] <- 14*4
l1$day[l1$time==6] <- 14*5
l1$state <- NA
l1$state[l1$piab_pos==0 & !is.na(l1$piab_pos)] <- 1
l1$state[l1$piab_pos==1 & !is.na(l1$piab_pos)] <- 2
q1 <- rbind(c( 0,0.01),
c(0.01,0)
)
l1 <- l1[order(l1$ID, l1$day),]
l2 <- l1[, c('state','child_contact_u5y','child_contact_u12m','child_contact_13_23m',"child_contact_24_59m","child_contact_5_10y",'child_contact_over10y', 'ID','day')]
l2 <- l1[, c('state','child_contact_u12m','child_contact_13_23m',"child_contact_24_59m","child_contact_5_10y",'child_contact_over10y', 'ID','day')]
l2$child_1_10 <- 0
l2$child_1_10[l2$child_contact_13_23m=='Yes' | l2$child_contact_24_59m=='Yes' | l2$child_contact_5_10y=='Yes'] <- 1
l2$child_2_10 <- 0
l2$child_2_10[ l2$child_contact_24_59m=='Yes' | l2$child_contact_5_10y=='Yes'] <- 1
l2$child_5_10 <- 0
l2$child_5_10[  l2$child_contact_5_10y=='Yes'] <- 1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2)
msm.mod1
msm.mod1a <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_u12m))
msm.mod1a
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_24_59m))
msm.mod1b
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact))
l2 <- l1[, c('state','child_contact','child_contact_u12m','child_contact_13_23m',"child_contact_24_59m","child_contact_5_10y",'child_contact_over10y', 'ID','day')]
l2$child_1_10 <- 0
l2$child_1_10[l2$child_contact_13_23m=='Yes' | l2$child_contact_24_59m=='Yes' | l2$child_contact_5_10y=='Yes'] <- 1
l2$child_2_10 <- 0
l2$child_2_10[ l2$child_contact_24_59m=='Yes' | l2$child_contact_5_10y=='Yes'] <- 1
l2$child_5_10 <- 0
l2$child_5_10[  l2$child_contact_5_10y=='Yes'] <- 1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2)
msm.mod1
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact))
msm.mod1b
mod.df$child_contact_u5[mod.df$child_contact_u12m==1 | mod.df$child_contact_13_23m==1 | mod.df$child_contact_24_59m==1] <- 1
mod.df$child_contact_u5 <- 0
mod.df$child_contact_u5[mod.df$child_contact_u12m==1 | mod.df$child_contact_13_23m==1 | mod.df$child_contact_24_59m==1] <- 1
mod.df <- ds.c %>%
filter(child_contact_13_23m!=9999 & !is.na(piab_pos)) %>%
mutate(ID=as.factor(ID))
mod.df$child_contact_u5 <- 0
mod.df$child_contact_u5[mod.df$child_contact_u12m==1 | mod.df$child_contact_13_23m==1 | mod.df$child_contact_24_59m==1] <- 1
l1 <- mod.df
l1$day <- 0
l1$day[l1$time==2] <- 14
l1$day[l1$time==3] <- 14*2
l1$day[l1$time==4] <- 14*3
l1$day[l1$time==5] <- 14*4
l1$day[l1$time==6] <- 14*5
l1$state <- NA
l1$state[l1$piab_pos==0 & !is.na(l1$piab_pos)] <- 1
l1$state[l1$piab_pos==1 & !is.na(l1$piab_pos)] <- 2
#l1$state <- as.factor(l1$state)
q1 <- rbind(c( 0,0.01),
c(0.01,0)
)
l1 <- l1[order(l1$ID, l1$day),]
l2 <- l1[, c('state','child_contact_u5','child_contact','child_contact_u12m','child_contact_13_23m',"child_contact_24_59m","child_contact_5_10y",'child_contact_over10y', 'ID','day')]
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2)
msm.mod1
msm.mod1a <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_u12m))
msm.mod1a
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_u5))
msm.mod1b
mod.df$child_contact_1_5 <- 0
mod.df$child_contact_1_5[ mod.df$child_contact_13_23m==1 | mod.df$child_contact_24_59m==1] <- 1
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_1_5))
mod.df <- ds.c %>%
filter(child_contact_13_23m!=9999 & !is.na(piab_pos)) %>%
mutate(ID=as.factor(ID))
mod.df$child_contact_u5 <- 0
mod.df$child_contact_u5[mod.df$child_contact_u12m==1 | mod.df$child_contact_13_23m==1 | mod.df$child_contact_24_59m==1] <- 1
mod.df$child_contact_1_5 <- 0
mod.df$child_contact_1_5[ mod.df$child_contact_13_23m==1 | mod.df$child_contact_24_59m==1] <- 1
l1 <- mod.df
l1$day <- 0
l1$day[l1$time==2] <- 14
l1$day[l1$time==3] <- 14*2
l1$day[l1$time==4] <- 14*3
l1$day[l1$time==5] <- 14*4
l1$day[l1$time==6] <- 14*5
l1$state <- NA
l1$state[l1$piab_pos==0 & !is.na(l1$piab_pos)] <- 1
l1$state[l1$piab_pos==1 & !is.na(l1$piab_pos)] <- 2
#l1$state <- as.factor(l1$state)
q1 <- rbind(c( 0,0.01),
c(0.01,0)
)
l1 <- l1[order(l1$ID, l1$day),]
l2 <- l1[, c('state','child_contact_u5','child_contact_1_5','child_contact','child_contact_u12m','child_contact_13_23m',"child_contact_24_59m","child_contact_5_10y",'child_contact_over10y', 'ID','day')]
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2)
msm.mod1
msm.mod1a <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_u12m))
msm.mod1a
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_1_5))
msm.mod1b
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_24_59m))
msm.mod1b
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_13_23m))
msm.mod1b
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_13_23m + child_contact_24_59m))
msm.mod1b
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_13_23m ))
msm.mod1b
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_1_5 ))
msm.mod1b
mod.df$child_contact_1_5 <- mod.df$child_contact_13_23m + mod.df$child_contact_24_59m
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_1_5))
msm.mod1b
mod.df$child_contact_u5 <-
mod.df$child_contact_u12m + mod.df$child_contact_13_23m + mod.df$child_contact_24_59m
#N contacts
mod.df$child_contact_1_5 <- mod.df$child_contact_13_23m + mod.df$child_contact_24_59m
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_u5))
msm.mod1b
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_1_5))
msm.mod1b
View(ds.c)
