ungroup()
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2),
Gender=if_else(ID=='S2_77' & is.na(Gender), 'F',Gender)) %>%
group_by(ID) %>%
#fill missing values when info is on survey for another time point
mutate( diabetes = if_else(diabetes==999 | is.na(diabetes),-999,diabetes),
diabetes = max(diabetes, na.rm=T),
diabetes = if_else(diabetes>=1,1,diabetes),
diabetes= as.factor(if_else(diabetes==-999,999, diabetes)),
asthma = if_else(asthma==999 |is.na(asthma),-999,asthma),
asthma = max(asthma, na.rm=T),
asthma = if_else(asthma>=1,1,asthma),
asthma= as.factor(if_else(asthma==-999,999, asthma))
) %>%
fill(education, direction='downup') %>%
ungroup()
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2),
Gender=if_else(ID=='S2_77' & is.na(Gender), 'F',Gender)) %>%
group_by(ID) %>%
#fill missing values when info is on survey for another time point
mutate( diabetes = if_else(diabetes==999 | is.na(diabetes),-999,diabetes),
diabetes = max(diabetes, na.rm=T),
diabetes = if_else(diabetes>=1,1,diabetes),
diabetes= as.factor(if_else(diabetes==-999,999, diabetes)),
asthma = if_else(asthma==999 |is.na(asthma),-999,asthma),
asthma = max(asthma, na.rm=T),
asthma = if_else(asthma>=1,1,asthma),
asthma= as.factor(if_else(asthma==-999,999, asthma))
) %>%
tidyr::fill(education, direction='downup') %>%
ungroup()
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2),
Gender=if_else(ID=='S2_77' & is.na(Gender), 'F',Gender)) %>%
group_by(ID) %>%
#fill missing values when info is on survey for another time point
mutate( diabetes = if_else(diabetes==999 | is.na(diabetes),-999,diabetes),
diabetes = max(diabetes, na.rm=T),
diabetes = if_else(diabetes>=1,1,diabetes),
diabetes= as.factor(if_else(diabetes==-999,999, diabetes)),
asthma = if_else(asthma==999 |is.na(asthma),-999,asthma),
asthma = max(asthma, na.rm=T),
asthma = if_else(asthma>=1,1,asthma),
asthma= as.factor(if_else(asthma==-999,999, asthma))
) %>%
tidyr::fill(.,education, direction='downup') %>%
ungroup()
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2),
Gender=if_else(ID=='S2_77' & is.na(Gender), 'F',Gender)) %>%
group_by(ID) %>%
#fill missing values when info is on survey for another time point
mutate( diabetes = if_else(diabetes==999 | is.na(diabetes),-999,diabetes),
diabetes = max(diabetes, na.rm=T),
diabetes = if_else(diabetes>=1,1,diabetes),
diabetes= as.factor(if_else(diabetes==-999,999, diabetes)),
asthma = if_else(asthma==999 |is.na(asthma),-999,asthma),
asthma = max(asthma, na.rm=T),
asthma = if_else(asthma>=1,1,asthma),
asthma= as.factor(if_else(asthma==-999,999, asthma))
) %>%
tidyr::fill(.,education, .direction='downup') %>%
ungroup()
first_visit <- pcr_survey %>% filter(time==1) %>%
mutate(Race=tolower(Race), Ethnicity=tolower(Ethnicity), smoke=as.factor(smoke), pneu_vax=as.factor(pneu_vax), flu_shot=as.factor(flu_shot) ,  asthma=as.factor(asthma),
education=toupper(education),
education_level= if_else(grepl('HIGH', education) |
grepl("GED",education) , 'HS',
if_else(grepl('BACHELOR', education) |
grepl('COLLEGE', education)|
grepl('ASSOCIATE', education)|
grepl('BA', education) ,'Undergrad',
if_else(grepl('MASTER', education)|
grepl('GRADUATE', education)|
grepl('MBA', education)|
grepl('PHD', education)|
grepl('JD', education)|
grepl('J.D.', education)|
grepl('MPH', education)|
grepl('MD', education)|
grepl('DOCTORATE', education), 'Graduate', 'Unknown')))
)
tab1 <- table1( ~Age + Gender + Race +Ethnicity + activity_family + activity_friends + activity_community_center +  smoke+ diabetes + asthma + pneu_vax + flu_shot +education_level , data=first_visit)
tab1 <- as.data.frame(tab1)
flextable(tab1)
t5 <- pcr_survey %>%
mutate(education=toupper(education),
education_level= if_else(grepl('HIGH', education) |
grepl("GED",education) , 'HS',
if_else(grepl('BACHELOR', education) |
grepl('COLLEGE', education)|
grepl('ASSOCIATE', education)|
grepl('BA', education) ,'Undergrad',
if_else(grepl('MASTER', education)|
grepl('GRADUATE', education)|
grepl('MBA', education)|
grepl('PHD', education)|
grepl('JD', education)|
grepl('J.D.', education)|
grepl('MPH', education)|
grepl('MD', education)|
grepl('DOCTORATE', education), 'Graduate', 'Unknown')))) %>%
group_by(education_level) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(education_level = if_else(is.na(education_level),'Unknown', education_level))
t5 <- as_grouped_data(x = t5, groups = c("education_level"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(recent_abx) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )%>%
mutate( recent_abx = if_else(is.na(recent_abx), 'Missing',recent_abx) )
t5 <- as_grouped_data(x = t5, groups = c("recent_abx"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
mutate(recent_pneumo_vax =as.character(recent_pneumo_vax )) %>%
group_by(recent_pneumo_vax) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )%>%
mutate( recent_pneumo_vax = if_else(is.na(recent_pneumo_vax), 'Missing',recent_pneumo_vax) )
t5 <- as_grouped_data(x = t5, groups = c("recent_pneumo_vax"), columns = NULL)
flextable(t5)
pcr_survey %>%
filter(piab_pos==1) %>%
group_by(diabetes) %>%
summarize(piab=mean(piab))
pcr_survey %>%
filter(lyta_pos==1) %>%
group_by(diabetes) %>%
summarize(lyta=mean(lyta))
pcr_survey_mod <-  pcr_survey %>%
filter(child_contact_13_23m!=9999 & !is.na(piab_pos)) %>%
mutate( child_contact_13_23m = if_else(child_contact_13_23m==9999,0, child_contact_13_23m),
child_contact_24_59m = if_else(child_contact_24_59m==9999,0, child_contact_24_59m),
child_contact_5_10y = if_else(child_contact_5_10y==9999,0, child_contact_5_10y),
N_child_contact_1_10 = child_contact_13_23m + child_contact_24_59m + child_contact_5_10y,
child_contact_hours=as.factor(child_contact_hours),
child_contact_often =as.factor(child_contact_often))
mod.df <- pcr_survey_mod %>%
filter(child_contact_13_23m!=9999 & !is.na(piab_pos)) %>%
mutate(ID=as.factor(ID))
mod.df$child_contact_u5 <-
mod.df$child_contact_u12m + mod.df$child_contact_13_23m + mod.df$child_contact_24_59m
mod.df$child_contact_1_10 <-  mod.df$child_contact_13_23m + mod.df$child_contact_24_59m +
mod.df$child_contact_5_10y
#N contacts
mod.df$child_contact_1_5 <- mod.df$child_contact_13_23m + mod.df$child_contact_24_59m
l1 <- mod.df
l1$day <- 0
l1$day[l1$time==2] <- 14
l1$day[l1$time==3] <- 14*2
l1$day[l1$time==4] <- 14*3
l1$day[l1$time==5] <- 14*4
l1$day[l1$time==6] <- 14*5
l1$state <- NA
l1$state[l1$piab_pos==0 & !is.na(l1$piab_pos)] <- 1
l1$state[l1$piab_pos==1 & !is.na(l1$piab_pos)] <- 2
#l1$state <- as.factor(l1$state)
q1 <- rbind(c( 0,0.01),
c(0.01,0)
)
l1 <- l1[order(l1$ID, l1$day),]
l2 <- l1[, c('state','child_contact_u5','child_contact_1_5','child_contact','Gender','child_contact_u12m','child_contact_13_23m',"child_contact_24_59m","child_contact_5_10y",'child_contact_over10y','child_contact_1_10', 'ID','day', 'season','child_contact_often','child_contact_hours', 'diabetes')] %>%
mutate(child_contact_2_10y = if_else( (child_contact_24_59m==1 |child_contact_5_10y==1) & child_contact !=9999,1,
if_else(child_contact_24_59m==0  & child_contact_5_10y==0 & child_contact !=9999,0,
if_else(child_contact==9999 ,9999, 9999) ) ))
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2)
msm.mod0
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_13_23m ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_24_59m ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_5_10y ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_2_10y ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_13_23m + child_contact_24_59m + child_contact_5_10y ))
msm.mod1
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_1_5))
msm.mod1b
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_u5))
msm.mod1b
msm.mod1c <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_1_10))
msm.mod1c
#clearance rate as a function of child contacts?
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list( "2-1" = ~ child_contact_1_10))
msm.mod1e
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list( "1-2" = ~ diabetes))
msm.mod0
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list( "2-1" = ~ diabetes))
msm.mod0
str(l2)
mutate(diabetes=relevel(diabetes, ref='0')
l2 <- l1[, c('state','child_contact_u5','child_contact_1_5','child_contact','Gender','child_contact_u12m','child_contact_13_23m',"child_contact_24_59m","child_contact_5_10y",'child_contact_over10y','child_contact_1_10', 'ID','day', 'season','child_contact_often','child_contact_hours', 'diabetes')] %>%
l2 <- l1[, c('state','child_contact_u5','child_contact_1_5','child_contact','Gender','child_contact_u12m','child_contact_13_23m',"child_contact_24_59m","child_contact_5_10y",'child_contact_over10y','child_contact_1_10', 'ID','day', 'season','child_contact_often','child_contact_hours', 'diabetes')] %>%
mutate(child_contact_2_10y = if_else( (child_contact_24_59m==1 |child_contact_5_10y==1) & child_contact !=9999,1,
if_else(child_contact_24_59m==0  & child_contact_5_10y==0 & child_contact !=9999,0,
if_else(child_contact==9999 ,9999, 9999) ) )) %>%
mutate(diabetes=relevel(diabetes, ref='0'))
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list( "1-2" = ~ diabetes))
msm.mod0
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list( "2-1" = ~ diabetes))
msm.mod0
t5 <- pcr_survey %>%
group_by(ID) %>%
ungroup() %>%
group_by(diabetes) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often))
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
season=substr(ID,1,2),
Gender=if_else(ID=='S2_77' & is.na(Gender), 'F',Gender)) %>%
group_by(ID) %>%
#fill missing values when info is on survey for another time point
mutate( diabetes = if_else(diabetes==999 | is.na(diabetes),-999,diabetes),
diabetes = max(diabetes, na.rm=T),
diabetes = if_else(diabetes>=1,1,diabetes),
diabetes= as.factor(if_else(diabetes==-999,999, diabetes)),
asthma = if_else(asthma==999 |is.na(asthma),-999,asthma),
asthma = max(asthma, na.rm=T),
asthma = if_else(asthma>=1,1,asthma),
asthma= as.factor(if_else(asthma==-999,999, asthma))
) %>%
tidyr::fill(.,education, .direction='downup') %>%
ungroup()
View(pcr_survey)
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
filter(piab != 9999)
View(pcr_survey)
View(pcr_survey %>% select(ID, diabetes))
names(pcr_survey)
View(pcr_survey)
pcr_summary_long <- readRDS('./Data/PCR_compiled.rds')
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2),
Gender=if_else(ID=='S2_77' & is.na(Gender), 'F',Gender)) %>%
group_by(ID) %>%
#fill missing values when info is on survey for another time point
mutate( diabetes = if_else(diabetes==999 | is.na(diabetes),-999,diabetes),
diabetes = max(diabetes, na.rm=T),
diabetes = if_else(diabetes>=1,1,diabetes),
diabetes= as.factor(if_else(diabetes==-999,999, diabetes)),
asthma = if_else(asthma==999 |is.na(asthma),-999,asthma),
asthma = max(asthma, na.rm=T),
asthma = if_else(asthma>=1,1,asthma),
asthma= as.factor(if_else(asthma==-999,999, asthma))
) %>%
tidyr::fill(.,education, .direction='downup') %>%
ungroup()
# diabetes <- pcr_survey %>%
#   group_by(Household) %>%
#   mutate(hh_diabetes=sum(diabetes, na.rm=T)) %>%
#   filter(hh_diabetes>=1) %>%
#   select(ID,time, Household, diabetes, lyta, piab, piab_pos) %>%
#   ungroup() %>%
#   group_by(ID,time, Household, diabetes) %>%
#   summarize(piab=mean(piab, na.rm=T), lyta=mean(lyta, na.rm=T))
#
# write.csv(diabetes, './Data/diabetes.csv')
t5 <- pcr_survey %>%
group_by(diabetes) %>%
summarize(N_lyta= sum(lyta_pos), N_test= n(), Pct_lyta=round(mean(lyta_pos)*100,1) )
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
##IN THIS CODING, 1= FREQUENT CONTACT; 0 = LESS FREQUENT CONTACT, NO CONTACT, NO RESPONSE
l3 <- l2 %>%
mutate(child_contact_often1 =if_else(child_contact_often %in% c('1','2'),1,0),
child_contact_often2 =if_else(child_contact_often %in% c('3'),1,0)) %>%
filter(child_contact !=9999)
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l3)
msm.mod1e
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l3,covariates = list( "1-2" = ~ child_contact_often1 + child_contact_often2))
msm.mod1e
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l3,covariates = list( "1-2" = ~ child_contact_often1 , "2-1" = ~ child_contact_often1 ))
msm.mod1e
str(l3$child_contact_often)
msm.mod1e
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l3,covariates = list( "1-2" = ~ child_contact_often1 + child_contact_often2))
msm.mod1e
l2.cat <- l2 %>%
mutate( child_contact_cat= if_else(child_contact1_10_dic==0 &child_contact_hours1==0 & child_contact_hours2==0,0,
if_else(child_contact1_10_dic==0 & (child_contact_hours1==1 | child_contact_hours2==1),1,
if_else(child_contact1_10_dic==1 & child_contact_hours1==1,2,
if_else(child_contact1_10_dic==1 & child_contact_hours2==1,3,999)))),
) %>%
filter(child_contact_cat %in% c(0,1,2,3)) %>%
mutate(child_contact_cat = as.factor(child_contact_cat))
l2 <- l2%>%
mutate(child_contact_hours1 =if_else(child_contact_hours %in% c('1'),1,0),
child_contact_hours2 =if_else(child_contact_hours %in% c('2','3'),1,0),
child_contact1_10_dic = if_else(child_contact_1_10>0,1,0))
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list( "1-2" = ~ child_contact_hours1 + child_contact_hours2))
msm.mod1e
l2.cat <- l2 %>%
mutate( child_contact_cat= if_else(child_contact1_10_dic==0 &child_contact_hours1==0 & child_contact_hours2==0,0,
if_else(child_contact1_10_dic==0 & (child_contact_hours1==1 | child_contact_hours2==1),1,
if_else(child_contact1_10_dic==1 & child_contact_hours1==1,2,
if_else(child_contact1_10_dic==1 & child_contact_hours2==1,3,999)))),
) %>%
filter(child_contact_cat %in% c(0,1,2,3)) %>%
mutate(child_contact_cat = as.factor(child_contact_cat))
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2.cat,covariates = list( "1-2" = ~ child_contact_cat ))
msm.mod1e
#prevalence by category
prop.table(table(l2.cat$child_contact_cat, l2.cat$state),margin=1)
prop.table(table(l2.cat$child_contact_cat, l2.cat$season),margin=2)
q1 <- rbind(c( 0,0.01),
c(0.01,0)
)
msm.mod2a <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ Gender))
msm.mod2a
msm.mod2b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("2-1" = ~ Gender))
msm.mod2b
#Or season
msm.mod2b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2[l2$Gender=='F',],covariates = list("2-1" = ~ season))
msm.mod2b
# msm.mod2b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ season))
# msm.mod2b
mod.df <- pcr_survey %>%
filter( !is.na(piab_pos)) %>%
mutate(ID=as.factor(ID))
recent_hh_col <- mod.df %>%
group_by(Household,time ) %>%
summarize(piab_pos=max(piab_pos)) %>%
mutate(time=time+1) %>%
rename(piab_pos_HH_prev = piab_pos)
recent_ID_col <- mod.df %>%
group_by(Household,ID,time ) %>%
summarize(piab_pos=sum(piab_pos)) %>%
mutate(time=time+1) %>%
rename(piab_pos_ID_prev = piab_pos)
#colonized_partner_prev is defined based on a positive household without positive individual on previous time
recent_col <- merge(recent_hh_col,recent_ID_col, by=c('Household', 'time') ) %>%
mutate(colonized_partner_prev = piab_pos_HH_prev - piab_pos_ID_prev)
mod.df <- merge(mod.df,recent_col, by=c('ID','Household', 'time'))
#N contacts
mod.df$child_contact_1_10 <- mod.df$child_contact_13_23m + mod.df$child_contact_24_59m  +mod.df$child_contact_5_10y
l1 <- mod.df
l1$day <- 0
l1$day[l1$time==2] <- 14
l1$day[l1$time==3] <- 14*2
l1$day[l1$time==4] <- 14*3
l1$day[l1$time==5] <- 14*4
l1$day[l1$time==6] <- 14*5
l1$state <- NA
l1$state[l1$piab_pos==0 & !is.na(l1$piab_pos)] <- 1
l1$state[l1$piab_pos==1 & !is.na(l1$piab_pos)] <- 2
q1 <- rbind(c( 0,0.01),
c(0.01,0)
)
l1 <- l1[order(l1$ID, l1$day),]
l2 <- l1[, c('state','Gender','child_contact_1_10', 'ID','day','colonized_partner_prev')]
table(l2$state, l2$colonized_partner_prev)
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ colonized_partner_prev ))
l3 <- l2 %>% filter(ID != 'S2_84')
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l4,covariates = list("1-2" = ~ colonized_partner_prev ))
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l3,covariates = list("1-2" = ~ colonized_partner_prev ))
msm.mod1
mod.df <- pcr_survey %>%
filter( !is.na(lyta_pos)) %>%
mutate(ID=as.factor(ID))
recent_hh_col <- mod.df %>%
group_by(Household,time ) %>%
summarize(lyta_pos=max(lyta_pos)) %>%
mutate(time=time+1) %>%
rename(lyta_pos_HH_prev = lyta_pos)
recent_ID_col <- mod.df %>%
group_by(Household,ID,time ) %>%
summarize(lyta_pos=sum(lyta_pos)) %>%
mutate(time=time+1) %>%
rename(lyta_pos_ID_prev = lyta_pos)
#colonized_partner_prev is defined based on a positive household without positive individual on previous time
recent_col <- merge(recent_hh_col,recent_ID_col, by=c('Household', 'time') ) %>%
mutate(colonized_partner_prev = lyta_pos_HH_prev - lyta_pos_ID_prev)
mod.df <- merge(mod.df,recent_col, by=c('ID','Household', 'time'))
#N contacts
mod.df$child_contact_1_10 <- mod.df$child_contact_13_23m + mod.df$child_contact_24_59m  +mod.df$child_contact_5_10y
l1 <- mod.df
l1$day <- 0
l1$day[l1$time==2] <- 14
l1$day[l1$time==3] <- 14*2
l1$day[l1$time==4] <- 14*3
l1$day[l1$time==5] <- 14*4
l1$day[l1$time==6] <- 14*5
l1$state <- NA
l1$state[l1$lyta_pos==0 & !is.na(l1$lyta_pos)] <- 1
l1$state[l1$lyta_pos==1 & !is.na(l1$lyta_pos)] <- 2
#l1$state <- as.factor(l1$state)
q1 <- rbind(c( 0,0.01),
c(0.01,0)
)
l1 <- l1[order(l1$ID, l1$day),]
l2 <- l1[, c('state','Gender','child_contact_1_10', 'ID','day','colonized_partner_prev', 'diabetes')]
table(l2$state, l2$colonized_partner_prev)
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2 )
msm.mod0
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ colonized_partner_prev ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ diabetes ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("2-1" = ~ diabetes ))
msm.mod1
l2 <- l1[, c('state','Gender','child_contact_1_10', 'ID','day','colonized_partner_prev', 'diabetes')] %>%
mutate(diabetes= relevel(diabetes, ref='0'))
table(l2$state, l2$colonized_partner_prev)
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2 )
msm.mod0
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ colonized_partner_prev ))
l2 <- l1[, c('state','Gender','child_contact_1_10', 'ID','day','colonized_partner_prev', 'diabetes')] %>%
mutate(diabetes= relevel(diabetes, ref='0')) %>%
filter(ID !='S2_84')
table(l2$state, l2$colonized_partner_prev)
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2 )
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ colonized_partner_prev ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ diabetes ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("2-1" = ~ diabetes ))
msm.mod1
table(l2$diabetes)
s1_repeats <- unique(ds.c$s1_match) #which people from S1 are also in S2?
repeat_people <- ds.c %>%
filter( ID %in% s1_repeats |  !is.na(s1_match)) %>%
mutate( Season_sample = if_else( is.na(s1_match) ,1,2),
uniqueID = if_else(Season_sample==1, ID,s1_match  )) %>%
arrange( uniqueID ,Season_sample,time) %>%
filter( !(uniqueID %in% c('S1_5','S1_47','S1_28', 'S1_70', 'S1_71', 'S1_29'))) #these have duplicates and need to be addressed
ds.plot <- repeat_people %>%
select(uniqueID,Season_sample, time, piab) %>%
dcast( uniqueID+ Season_sample ~time) %>%
arrange(uniqueID,Season_sample) %>%
group_by(uniqueID) %>%
mutate(pair_order= row_number())
cut3 = 47
cut4=95
cut5=141
ds.plot$labels <- paste(ds.plot$uniqueID, ds.plot$Season_sample, sep='_')
breakslist<-seq(15,45,by=1)
weeks<- paste0('Week ', c(0,2,4,6,8,10))
sub1 <- ds.plot[1:52,]
gap1 <- which(sub1$pair_order==1) +1
gap1 <- gap1[-length(gap1)]
sub2 <- ds.plot[53:106,]
gap2 <- which(sub2$pair_order==1) +1
gap2 <- gap2[-length(gap2)]
#First half
heat1 <- (pheatmap(sub1[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap1,
labels_row = sub1$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks))
heat2 <- (pheatmap(sub2[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap2,
labels_row = sub2$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks))
grid.arrange(heat1[[4]],heat2[[4]],ncol=2)
