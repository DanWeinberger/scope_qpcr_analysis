s2_surv <- read.csv('./Data/confidential/Season_2_Surveys/fornightly_DATA_2022-09-19.csv') %>%
rename(scope_id=participant_id,
child_contact=child_contact_2weeks,
child_contact_u12m=child_contact_age___1,
child_contact_13_23m=child_contact_age___2,
child_contact_24_59m=child_contact_age___3,
child_contact_5_10y=child_contact_age___4,
child_contact_over10y=child_contact_age___5,
activity_community_center=activities_describe___1,
activity_friends=activities_describe___2,
activity_family=activities_describe___3,
acitivity_fitness=activities_describe___4,
activity_other=activities_describe___5
) %>%
mutate(ID = paste0('S2_',gsub("\\..*","",floor(scope_id))) , time=visit_number)
table(s2_surv$visit_number)
d1.ds <- readRDS( './Data/PCR_compiled.rds')
s1_demographics <- readRDS('./Data/confidential/s1_baseline_vars.rds') %>%
rename(`season 1 scope ID`=ID, Age=Age2, Gender=Gender2, Race=Race2,Ethnicity=Ethnicity2) %>%
mutate(`season 1 scope ID`=as.numeric(`season 1 scope ID`)) %>%
dplyr::select(-MRN_cleaned)
s2_demographics_b <- read_excel('./Data/confidential/New Participants SCOPE_season 2.xlsx', sheet='repeat participant cheat sheet')
s2_demographics_b2 <- left_join(s2_demographics_b,s1_demographics, by="season 1 scope ID") %>%
rename(ID=`season 2 scope ID`, s1_match=`season 1 scope ID`) %>%
rename(pneu_vax1=pneu_vax,
immuno_meds1=immuno,
diabetes_meds1=diabetes,
asthma_meds1=asthma,
flu_shot1=flu_shot
) %>%
mutate(s1_match = paste0('S1_',s1_match),
pneu_vax = if_else(pneu_vax1=='Yes',1,
if_else(pneu_vax1=='No',0, NA_real_)),
flu_shot = if_else(flu_shot1=='Yes',1,
if_else(flu_shot1=='No',2, NA_real_)),
asthma = if_else(asthma_meds1=='Yes',1,
if_else(asthma_meds1=='No',2, NA_real_)),
diabetes = if_else(diabetes_meds1=='Yes',1,
if_else(diabetes_meds1=='No',2, NA_real_)),
smoke = if_else(current_smoke=='Yes, cigarettes',1,
if_else(current_smoke=='No',2, NA_real_))
) %>%
select(ID, s1_match,Age, Gender, Race, Ethnicity, smoke,pneu_vax,pneu_vax_date, education , diabetes,asthma, flu_shot )
s2_demographics_a <- read_excel('./Data/confidential/New Participants SCOPE_season 2.xlsx', sheet='new participants season 2') %>%
rename(ID = `scope ID`, Race = `How would you describe your ethnicity?`,
Ethnicity = `Would you consider yourself Hispanic or Non-Hispanic?`,
dob= `What is your date of birth?`,
pneu_vax_date= pcv_date,
pneu_vax=pcv
) %>%
mutate(Age = lubridate::time_length(difftime(as.Date('2022-01-01'), dob), "years"), pneu_vax_date=as.character(pneu_vax_date) ) %>%
select(ID, Age, Gender, Race, Ethnicity, education, weight, height, pneu_vax, pneu_vax_date, flu_shot, flu_shot_when,
diabetes, asthma, smoke, number_cigarettes, smoked, quit_smoking) #chronic_heart_disease,congestive_heart_failure,enlarged_or_thick_heart,chronic_liver_disease,liver_cirrhosis,liver_cancer,chronic_lung_disease,chronic_obstructive_pulm,emphysema,
s2_demographics <- bind_rows(s2_demographics_a, s2_demographics_b2) %>%
mutate(ID= paste0('S2_',ID))
s2_pcr <- d1.ds[grep('S2', d1.ds$ID),]
s2_a <- merge(s2_pcr, s2_surv, by=c('ID','time'), all=T) %>%
mutate(piab_pos = 1*(piab<40))
N_surveys <- dcast(s2_a[c('ID','time','child_contact')], ID~time, fun.aggregate = length)
s2_a <- s2_a %>%
filter(!is.na(time))
s2_a$child_contact[is.na(s2_a$child_contact)] <- 9999
s2_a$child_contact[is.infinite(s2_a$child_contact)] <- 9999
s2_a$child_contact_u12m[is.na(s2_a$child_contact_u12m)] <-9999
s2_a$child_contact_13_23m[is.na(s2_a$child_contact_13_23m)] <-9999
s2_a$child_contact_24_59m[is.na(s2_a$child_contact_24_59m)] <-9999
s2_a$child_contact_5_10y[is.na(s2_a$child_contact_5_10y)] <-9999
s2_a$child_contact_over10y[is.na(s2_a$child_contact_over10y)] <-9999
s2_a <- merge(s2_a,s2_demographics, by='ID', all=T)
s2_a <- s2_a %>%
group_by(ID, time) %>%
mutate(repN=row_number(),
recent_pneumo_vax = if_else(vaccines_new==3, 1, 0),
recent_flu_vax = if_else(vaccines_new==2, 1, 0),
recent_covid_vax = if_else(vaccines_new==4, 1, 0)
)%>%
filter(repN==1 & !is.na(Household)) %>%
ungroup()
N_contacts <- dcast(s2_a[c('ID','time','child_contact')], ID~time, fun.aggregate = max, na.rm=T, fill=9999)
##Clean S2 surveys
library(dplyr)
#84.3,84.4,84.5,84.6.The participants were at the hospital at the time to produce saliva.
#Participants 55.3,53.2,56.3 they couldnâ€™t produce saliva.
#ID 37,38 no participants was attribute to that household.
clean_s2_surveys <- function(){
s2_surv <- read.csv('./Data/confidential/Season_2_Surveys/fornightly_DATA_2022-09-19.csv') %>%
rename(scope_id=participant_id,
child_contact=child_contact_2weeks,
child_contact_u12m=child_contact_age___1,
child_contact_13_23m=child_contact_age___2,
child_contact_24_59m=child_contact_age___3,
child_contact_5_10y=child_contact_age___4,
child_contact_over10y=child_contact_age___5,
activity_community_center=activities_describe___1,
activity_friends=activities_describe___2,
activity_family=activities_describe___3,
acitivity_fitness=activities_describe___4,
activity_other=activities_describe___5
) %>%
mutate(ID = paste0('S2_',gsub("\\..*","",floor(scope_id))) , time=visit_number)
table(s2_surv$visit_number)
d1.ds <- readRDS( './Data/PCR_compiled.rds')
# s1_data <- readRDS('./Data/confidential/s1_survey_clean.rds') %>%
#   `[[`('survey_and_pcr_s1') %>%
#   dplyr::select(ID, Age, Gender, Race, Ethnicity,smoke_dic,pneu_vax_dic) %>%
#   unique() %>%
#   filter(!is.na(ID))
s1_demographics <- readRDS('./Data/confidential/s1_baseline_vars.rds') %>%
rename(`season 1 scope ID`=ID, Age=Age2, Gender=Gender2, Race=Race2,Ethnicity=Ethnicity2) %>%
mutate(`season 1 scope ID`=as.numeric(`season 1 scope ID`)) %>%
dplyr::select(-MRN_cleaned)
s2_demographics_b <- read_excel('./Data/confidential/New Participants SCOPE_season 2.xlsx', sheet='repeat participant cheat sheet')
s2_demographics_b2 <- left_join(s2_demographics_b,s1_demographics, by="season 1 scope ID") %>%
rename(ID=`season 2 scope ID`, s1_match=`season 1 scope ID`) %>%
rename(pneu_vax1=pneu_vax,
immuno_meds1=immuno,
diabetes_meds1=diabetes,
asthma_meds1=asthma,
flu_shot1=flu_shot
) %>%
mutate(s1_match = paste0('S1_',s1_match),
pneu_vax = if_else(pneu_vax1=='Yes',1,
if_else(pneu_vax1=='No',0, NA_real_)),
flu_shot = if_else(flu_shot1=='Yes',1,
if_else(flu_shot1=='No',2, NA_real_)),
asthma = if_else(asthma_meds1=='Yes',1,
if_else(asthma_meds1=='No',2, NA_real_)),
diabetes = if_else(diabetes_meds1=='Yes',1,
if_else(diabetes_meds1=='No',2, NA_real_)),
smoke = if_else(current_smoke=='Yes, cigarettes',1,
if_else(current_smoke=='No',2, NA_real_))
) %>%
select(ID, s1_match,Age, Gender, Race, Ethnicity, smoke,pneu_vax,pneu_vax_date, education , diabetes,asthma, flu_shot )
s2_demographics_a <- read_excel('./Data/confidential/New Participants SCOPE_season 2.xlsx', sheet='new participants season 2') %>%
rename(ID = `scope ID`, Race = `How would you describe your ethnicity?`,
Ethnicity = `Would you consider yourself Hispanic or Non-Hispanic?`,
dob= `What is your date of birth?`,
pneu_vax_date= pcv_date,
pneu_vax=pcv
) %>%
mutate(Age = lubridate::time_length(difftime(as.Date('2022-01-01'), dob), "years"), pneu_vax_date=as.character(pneu_vax_date) ) %>%
select(ID, Age, Gender, Race, Ethnicity, education, weight, height, pneu_vax, pneu_vax_date, flu_shot, flu_shot_when,
diabetes, asthma, smoke, number_cigarettes, smoked, quit_smoking) #chronic_heart_disease,congestive_heart_failure,enlarged_or_thick_heart,chronic_liver_disease,liver_cirrhosis,liver_cancer,chronic_lung_disease,chronic_obstructive_pulm,emphysema,
s2_demographics <- bind_rows(s2_demographics_a, s2_demographics_b2) %>%
mutate(ID= paste0('S2_',ID))
s2_pcr <- d1.ds[grep('S2', d1.ds$ID),]
s2_a <- merge(s2_pcr, s2_surv, by=c('ID','time'), all=T) %>%
mutate(piab_pos = 1*(piab<40))
N_surveys <- dcast(s2_a[c('ID','time','child_contact')], ID~time, fun.aggregate = length)
s2_a <- s2_a %>%
filter(!is.na(time))
s2_a$child_contact[is.na(s2_a$child_contact)] <- 9999
s2_a$child_contact[is.infinite(s2_a$child_contact)] <- 9999
s2_a$child_contact_u12m[is.na(s2_a$child_contact_u12m)] <-9999
s2_a$child_contact_13_23m[is.na(s2_a$child_contact_13_23m)] <-9999
s2_a$child_contact_24_59m[is.na(s2_a$child_contact_24_59m)] <-9999
s2_a$child_contact_5_10y[is.na(s2_a$child_contact_5_10y)] <-9999
s2_a$child_contact_over10y[is.na(s2_a$child_contact_over10y)] <-9999
s2_a <- merge(s2_a,s2_demographics, by='ID', all=T)
s2_a <- s2_a %>%
group_by(ID, time) %>%
mutate(repN=row_number(),
recent_pneumo_vax = if_else(vaccines_new==3, 1, 0),
recent_flu_vax = if_else(vaccines_new==2, 1, 0),
recent_covid_vax = if_else(vaccines_new==4, 1, 0)
)%>%
filter(repN==1 & !is.na(Household)) %>%
ungroup()
N_contacts <- dcast(s2_a[c('ID','time','child_contact')], ID~time, fun.aggregate = max, na.rm=T, fill=9999)
out.list <- list('survey_and_pcr_s2'=s2_a,'contacts_wide_s2'=N_contacts)
return(out.list)
}
s2_data <- clean_s2_surveys()
table(s2_data$survey_and_pcr_s2$diabetes)
s1 <- s1_data$survey_and_pcr_s1 %>%
rename(flu_shot1=flu_shot) %>%
mutate(flu_shot = if_else(flu_shot1=='Yes',1,
if_else(flu_shot1=='No',2, NA_real_)),
diabetes = if_else(diabetes=='Yes',1,
if_else(diabetes=='No',2, NA_real_)),
asthma = if_else(asthma=='Yes',1,
if_else(asthma=='No',2, NA_real_))
) %>%
select(ID, time, Household, lyta, piab,activities, activity_family, activity_friends, activity_community_center, acitivity_fitness,child_contact,child_contact_u12m,child_contact_13_23m,child_contact_24_59m ,child_contact_5_10y,child_contact_over10y , Age, Gender, Race, Ethnicity,child_contact_often,child_contact_hours,recent_abx,recent_runny_nose, recent_nasal,
smoke_dic, pneu_vax_dic, flu_shot,education,diabetes, asthma)  %>%
rename(pneu_vax=pneu_vax_dic, smoke=smoke_dic)
s2 <- s2_data$survey_and_pcr_s2  %>%
mutate(recent_runny_nose = if_else(running_nose==1,'Yes', if_else(running_nose==2,'No','999') ),
recent_nasal = if_else(nasal_congestion==1,'Yes', if_else(nasal_congestion==2,'No','999') ),
recent_abx = if_else(antibiotics_2weeks==1,'Yes', if_else(antibiotics_2weeks==0,'No','999') )
)%>%
select(ID, time, Household,s1_match, lyta, piab,activities, activity_family, activity_friends, activity_community_center, acitivity_fitness,child_contact, child_contact_u12m,child_contact_13_23m,child_contact_24_59m ,child_contact_5_10y,child_contact_over10y, Age, Gender, Race, Ethnicity,
child_contact_often,child_contact_hours,recent_runny_nose,recent_nasal, recent_abx,recent_pneumo_vax, recent_flu_vax, recent_covid_vax,
smoke,pneu_vax, flu_shot,education,diabetes, asthma)
ds.c <- bind_rows(s1, s2) %>%
mutate(season= str_extract(ID, "[^_]+"),
piab_pos=1*(piab<45) ,
Age=round(Age),
agec = if_else(Age>=60 & Age <70 ,1,
if_else(Age>=70 & Age<100 ,2,NA_real_ )),
smoke=if_else(smoke==2,0, smoke),
flu_shot=if_else(flu_shot==2,0, flu_shot),
diabetes=if_else(diabetes==2,0, diabetes),
asthma=if_else(asthma==2,0, asthma)) %>%
filter(!is.na(ID))
write.csv(ds.c,'./Data/pcr_survey_combined.csv')
table(ds.c$diabetes)
knitr::opts_chunk$set(echo = FALSE)
library(readxl)
library(reshape2)
library(dplyr)
library(stringr)
library(pheatmap)
library(RColorBrewer)
library(cowplot)
library(gridExtra)
library(ggplot2)
library(ggplotify)
library(table1)
library(lubridate)
library(patchwork)
library(msm)
library(gee)
source('heat.fun.R')
source('heat.fun.contact.R')
source('./R/clean_pcr.R')
source('./R/clean_s1_surveys.R')
source('./R/clean_s2_surveys.R')
clean_pcr <- clean_pcr_fun()
plot(clean_pcr$pcr_summary_long$lyta, clean_pcr$pcr_summary_long$piab, xlim= c(45,0), ylim=c(45,0), xlab='lytA', ylab='piaB', bty='l')
abline(a=0, b=1)
abline(h=40, v=40, col='gray', lty=2)
piab.plot <- heat.fun(target='piab')
# breakslist<-seq(15,45,by=1)
#
# cols1 <- colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist))
#
# p1 <- ggplot(d1.ds, aes(time, HH_order, fill= piab)) +
#   geom_tile() +
#   scale_fill_viridis_c(option = "B", direction = -1) +
#
#   theme_classic()+
#   ylab('Serotype tested')+
#    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#   facet_wrap(~Household, ncol=3)+
#   theme(
#   strip.text.x = element_blank()
# )
# p1
lyta.plot <- heat.fun(target='lyta')
c1.m.m <- melt(clean_pcr$pcr_summary[,c('Target','ID','Sample','ct_pos2','Household') ],
id.vars=c('Target','ID','Sample','Household'))
c1.m.c <- dcast(c1.m.m, ID + Household + Sample  ~Target, fun.aggregate = min, fill=999)
#N people
N.id <- length(unique(c1.m.c$ID))
N.id
#N households
N.hh<- length(unique(c1.m.c$Household))
N.hh
#N samples
nrow(c1.m.c)
#length(unique(c1.m.c$Sample[c1.m$Target=='piab']))
#length(unique(c1.m.c$Sample[c1.m$Target=='lyta']))
#N positive
sum(c1.m.c$piab<40 )
sum(c1.m.c$piab<40  &c1.m.c$lyta>=40)
sum(c1.m.c$piab<40  &c1.m.c$lyta<40)
#% positive
sum(c1.m.c$piab<40 )/nrow(c1.m.c)
#N positive lytA
sum(c1.m.c$lyta<40 )
sum(c1.m.c$lyta<40 )/nrow(c1.m.c)
#Count N people with piaB positives by IDs
c1.m.spl.id <- split(c1.m.c, c1.m.c$ID)
N_pos_people <- sum(sapply(c1.m.spl.id, function(x){
min(x$piab) <40
}
))
N_pos_people
N_pos_people/N.id
#Count N HH with piab positives by IDs
c1.m.spl.id <- split(c1.m.c, c1.m.c$Household)
n_pos_hh <- sum(sapply(c1.m.spl.id, function(x){
min(x$piab) <40
}
))
n_pos_hh
n_pos_hh/N.hh
# ## Ave age
# age1 <- read_excel('./Data/confidential/AGE Scope Participants samples pick-up 06-15-2021.xlsx', skip=1)
# names(age1)[1] <- 'ID'
# age1 <- age1[ which(age1$ID %in% unique(c1.m.c$ID)),]
# mean(age1$AGE)
# range(age1$AGE)
s1_data <- clean_s1_surveys()
saveRDS(s1_data,'./Data/confidential/s1_survey_clean.rds')
s2_data <- clean_s2_surveys()
s1 <- s1_data$survey_and_pcr_s1 %>%
rename(flu_shot1=flu_shot) %>%
mutate(flu_shot = if_else(flu_shot1=='Yes',1,
if_else(flu_shot1=='No',2, NA_real_)),
diabetes = if_else(diabetes=='Yes',1,
if_else(diabetes=='No',2, NA_real_)),
asthma = if_else(asthma=='Yes',1,
if_else(asthma=='No',2, NA_real_))
) %>%
select(ID, time, Household, lyta, piab,activities, activity_family, activity_friends, activity_community_center, acitivity_fitness,child_contact,child_contact_u12m,child_contact_13_23m,child_contact_24_59m ,child_contact_5_10y,child_contact_over10y , Age, Gender, Race, Ethnicity,child_contact_often,child_contact_hours,recent_abx,recent_runny_nose, recent_nasal,
smoke_dic, pneu_vax_dic, flu_shot,education,diabetes, asthma)  %>%
rename(pneu_vax=pneu_vax_dic, smoke=smoke_dic)
s2 <- s2_data$survey_and_pcr_s2  %>%
mutate(recent_runny_nose = if_else(running_nose==1,'Yes', if_else(running_nose==2,'No','999') ),
recent_nasal = if_else(nasal_congestion==1,'Yes', if_else(nasal_congestion==2,'No','999') ),
recent_abx = if_else(antibiotics_2weeks==1,'Yes', if_else(antibiotics_2weeks==0,'No','999') )
)%>%
select(ID, time, Household,s1_match, lyta, piab,activities, activity_family, activity_friends, activity_community_center, acitivity_fitness,child_contact, child_contact_u12m,child_contact_13_23m,child_contact_24_59m ,child_contact_5_10y,child_contact_over10y, Age, Gender, Race, Ethnicity,
child_contact_often,child_contact_hours,recent_runny_nose,recent_nasal, recent_abx,recent_pneumo_vax, recent_flu_vax, recent_covid_vax,
smoke,pneu_vax, flu_shot,education,diabetes, asthma)
ds.c <- bind_rows(s1, s2) %>%
mutate(season= str_extract(ID, "[^_]+"),
piab_pos=1*(piab<45) ,
Age=round(Age),
agec = if_else(Age>=60 & Age <70 ,1,
if_else(Age>=70 & Age<100 ,2,NA_real_ )),
smoke=if_else(smoke==2,0, smoke),
flu_shot=if_else(flu_shot==2,0, flu_shot),
diabetes=if_else(diabetes==2,0, diabetes),
asthma=if_else(asthma==2,0, asthma)) %>%
filter(!is.na(ID))
#Missing gender: S1_1, S1_11, S1_12, S1_18, S1_19, S1_2, S1_21, S1_28, S1_29, S1_3, S1_34, S1_35, S1_37, S1_4, s1_44, S1_45, s1_5, S1_6, s1_60, s1_61, S1_62, S1_63, s2_77
write.csv(ds.c,'./Data/pcr_survey_combined.csv')
saveRDS(ds.c,'./Data/pcr_survey_combined.rds')
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
options(dplyr.summarise.inform = FALSE)
library(ggplot2)
library(ggalluvial)
library(kableExtra)
library(knitr)
library(readxl)
library(gee)
library(reshape2)
library(flextable)
library(msm)
library(patchwork)
library(gridExtra)
library(pheatmap)
library(RColorBrewer)
library(table1)
source('heat.fun.R')
source('heat.fun.contact.R')
source('./R/clean_pcr.R')
source('./R/clean_s1_surveys.R')
source('./R/clean_s2_surveys.R')
clean_pcr <- clean_pcr_fun()
pcr_summary_long <- readRDS('./Data/PCR_compiled.rds')
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2),
Gender=if_else(ID=='S2_77' & is.na(Gender), 'F',Gender))
unique.age <- pcr_survey %>%
group_by(ID) %>%
summarize(Age=mean(Age, na.rm=T))
hist(unique.age$Age, main='Distribution of ages', xlab='Age(y)')
unique.age %>%
summarize(mean=mean(Age, na.rm=T), min=min(Age, na.rm=T), max=max(Age, na.rm=T))
first_visit <- pcr_survey %>% filter(time==1) %>%
mutate(Race=tolower(Race), Ethnicity=tolower(Ethnicity), smoke=as.factor(smoke), pneu_vax=as.factor(pneu_vax), flu_shot=as.factor(flu_shot) , diabetes=as.factor(diabetes), asthma=as.factor(asthma),
education=toupper(education),
education_level= if_else(grepl('HIGH', education) |
grepl("GED",education) , 'HS',
if_else(grepl('BACHELOR', education) |
grepl('COLLEGE', education)|
grepl('ASSOCIATE', education)|
grepl('BA', education) ,'Undergrad',
if_else(grepl('MASTER', education)|
grepl('GRADUATE', education)|
grepl('MBA', education)|
grepl('PHD', education)|
grepl('JD', education)|
grepl('J.D.', education)|
grepl('MPH', education)|
grepl('MD', education)|
grepl('DOCTORATE', education), 'Graduate', 'Unknown')))
)
tab1 <- table1( ~Age + Gender + Race +Ethnicity + activity_family + activity_friends + activity_community_center +  smoke+ diabetes + asthma + pneu_vax + flu_shot +education_level , data=first_visit)
tab1 <- as.data.frame(tab1)
flextable(tab1)
p1 <- ggplot(pcr_summary_long,aes(x=lyta, y=piab, alpha=0.5))+
theme_classic() +
geom_point() +
ylim(45,10) +
xlim(45,10)+
xlab('lytA') +
ylab('piaB') +
theme(legend.position = "none") +
geom_abline(col='gray', lty=2) +
geom_hline(yintercept=40,col='gray', lty=3)+
geom_vline(xintercept=40,col='gray', lty=3)
p1
piab.plot <- heat.fun(target='piab')
# breakslist<-seq(15,45,by=1)
#
# cols1 <- colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist))
#
# p1 <- ggplot(d1.ds, aes(time, HH_order, fill= piab)) +
#   geom_tile() +
#   scale_fill_viridis_c(option = "B", direction = -1) +
#
#   theme_classic()+
#   ylab('Serotype tested')+
#    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#   facet_wrap(~Household, ncol=3)+
#   theme(
#   strip.text.x = element_blank()
# )
# p1
t1 <- pcr_summary_long %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0)) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), `Percent piab`=round(mean(piab_pos)*100,2) )
flextable(t1)
t2 <- pcr_summary_long %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0), season=substr(ID,1,2)) %>%
group_by(season) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )
flextable(t2)
pcr_summary_long %>%
filter(!is.na(Household)) %>%
summarize(N_hh=length(unique(pcr_summary_long$Household)), N_people=length(unique(pcr_summary_long$ID)))
t3 <- pcr_summary_long %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2) ) %>%
group_by(ID) %>%
summarize(any_pos_piab = max(piab_pos)) %>%
ungroup() %>%
summarize(N_people=n(), N_pos=sum(any_pos_piab), `Percent Positive People`=round(100*mean(any_pos_piab),1))
flextable(t3)
t3 <- pcr_summary_long %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2) ) %>%
group_by(ID,season) %>%
summarize(any_pos_piab = max(piab_pos)) %>%
ungroup() %>%
group_by(season) %>%
summarize(N_people=n(), N_pos=sum(any_pos_piab), `Percent Positive People`=round(100*mean(any_pos_piab),1))
flextable(t3)
t4 <-     pcr_summary_long %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2) ) %>%
group_by(Household,season) %>%
summarize(any_pos_piab = max(piab_pos)) %>%
ungroup() %>%
group_by(season) %>%
summarize(N_households=n(), N_pos=sum(any_pos_piab), `Percent Positive HH`=round(100*mean(any_pos_piab),1))
flextable(t4)
t5 <- pcr_survey %>%
group_by(Gender,season) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )
t5 <- as_grouped_data(x = t5, groups = c("Gender"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(ID,Gender,season) %>%
summarize(piaB_period_pos= max(piab_pos) ) %>%
ungroup() %>%
group_by(Gender, season) %>%
summarize(N_pos_people=sum(piaB_period_pos), N_people=n() ) %>%
mutate(period_prev=round(100*N_pos_people/N_people,1))
flextable(t5)
t5 <- pcr_survey %>%
group_by(recent_nasal) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate( recent_nasal = if_else(is.na(recent_nasal), 'Missing',recent_nasal) )
t5 <- as_grouped_data(x = t5, groups = c("recent_nasal"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(recent_runny_nose) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )%>%
mutate( recent_runny_nose = if_else(is.na(recent_runny_nose), 'Missing',recent_runny_nose) )
t5 <- as_grouped_data(x = t5, groups = c("recent_runny_nose"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(pneu_vax) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(pneu_vax = if_else(is.na(pneu_vax),999, pneu_vax))
t5 <- as_grouped_data(x = t5, groups = c("pneu_vax"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(diabetes) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(diabetes = if_else(is.na(diabetes),999, diabetes))
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(diabetes) %>%
summarize(N_lyta= sum(lyta_pos), N_test= n(), Pct_lyta=round(mean(lyta_pos)*100,1) ) %>%
mutate(diabetes = if_else(is.na(diabetes),999, diabetes))
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
