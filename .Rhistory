flextable(t5)
t5 <- pcr_survey %>%
group_by(ID,Gender,season) %>%
summarize(piaB_period_pos= max(piab_pos) ) %>%
ungroup() %>%
group_by(Gender, season) %>%
summarize(N_pos_people=sum(piaB_period_pos), N_people=n() ) %>%
mutate(period_prev=round(100*N_pos_people/N_people,1))
flextable(t5)
t5 <- pcr_survey %>%
group_by(recent_nasal) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate( recent_nasal = if_else(is.na(recent_nasal), 'Missing',recent_nasal) )
t5 <- as_grouped_data(x = t5, groups = c("recent_nasal"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(recent_runny_nose) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )%>%
mutate( recent_runny_nose = if_else(is.na(recent_runny_nose), 'Missing',recent_runny_nose) )
t5 <- as_grouped_data(x = t5, groups = c("recent_runny_nose"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(pneu_vax) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(pneu_vax = if_else(is.na(pneu_vax),999, pneu_vax))
t5 <- as_grouped_data(x = t5, groups = c("pneu_vax"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(ID) %>%
ungroup() %>%
group_by(diabetes) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(diabetes) %>%
summarize(N_lyta= sum(lyta_pos), N_test= n(), Pct_lyta=round(mean(lyta_pos)*100,1) )
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(asthma) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )
t5 <- as_grouped_data(x = t5, groups = c("asthma"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
mutate(education=toupper(education),
education_level= if_else(grepl('HIGH', education) |
grepl("GED",education) , 'HS',
if_else(grepl('BACHELOR', education) |
grepl('COLLEGE', education)|
grepl('ASSOCIATE', education)|
grepl('BA', education) ,'Undergrad',
if_else(grepl('MASTER', education)|
grepl('GRADUATE', education)|
grepl('MBA', education)|
grepl('PHD', education)|
grepl('JD', education)|
grepl('J.D.', education)|
grepl('MPH', education)|
grepl('MD', education)|
grepl('DOCTORATE', education), 'Graduate', 'Unknown')))) %>%
group_by(education_level) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(education_level = if_else(is.na(education_level),'Unknown', education_level))
t5 <- as_grouped_data(x = t5, groups = c("education_level"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(recent_abx) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )%>%
mutate( recent_abx = if_else(is.na(recent_abx), 'Missing',recent_abx) )
t5 <- as_grouped_data(x = t5, groups = c("recent_abx"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
mutate(recent_pneumo_vax =as.character(recent_pneumo_vax )) %>%
group_by(recent_pneumo_vax) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )%>%
mutate( recent_pneumo_vax = if_else(is.na(recent_pneumo_vax), 'Missing',recent_pneumo_vax) )
t5 <- as_grouped_data(x = t5, groups = c("recent_pneumo_vax"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
mutate(pneu_vax =as.character(pneu_vax )) %>%
group_by(pneu_vax) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )%>%
mutate( pneu_vax = if_else(is.na(pneu_vax), 'Missing',pneu_vax) )
t5 <- as_grouped_data(x = t5, groups = c("pneu_vax"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
mutate(flu_shot =as.character(flu_shot )) %>%
group_by(flu_shot) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )%>%
mutate( flu_shot = if_else(is.na(flu_shot), 'Missing',flu_shot) )
t5 <- as_grouped_data(x = t5, groups = c("flu_shot"), columns = NULL)
flextable(t5)
t6 <- pcr_survey %>%
filter(activity_family!=9999) %>%
group_by( Gender, season) %>%
summarize(N_Activity_family=sum(activity_family, na.rm=T), N=n(), Pct=round(100*mean(activity_family, na.rm=T),2))
t6 <- as_grouped_data(x = t6, groups = c("Gender"), columns = NULL)
flextable(t6) #
t7 <-pcr_survey %>%
filter(child_contact_u12m!=9999) %>%
group_by( Gender,season) %>%
mutate(child_contact_u5 = if_else( (child_contact_u12m==1 |child_contact_13_23m==1 | child_contact_24_59m==1),1,0   )) %>%
summarize(N_contact_u5=sum(child_contact_u5, na.rm=T), N=n(), Pct=round(100*mean(child_contact_u5, na.rm=T),2))
t7 <- as_grouped_data(x = t7, groups = c("Gender"), columns = NULL)
flextable(t7)
t8 <- pcr_survey %>%
filter(child_contact_u12m!=9999) %>%
group_by( Gender,season) %>%
summarize(N_contact_u12m=sum(child_contact_u12m, na.rm=T), N=n(), Pct=round(100*mean(child_contact_u12m, na.rm=T),1))
t8 <- as_grouped_data(x = t8, groups = c("Gender"), columns = NULL)
flextable(t8)
t9 <- pcr_survey %>%
filter(child_contact_13_23m!=9999) %>%
group_by(Gender,season) %>%
summarize(N_contact_12_23m=sum(child_contact_13_23m, na.rm=T), N=n(), Pct=round(100*mean(child_contact_13_23m, na.rm=T),2))
t9 <- as_grouped_data(x = t9, groups = c("Gender"), columns = NULL)
flextable(t9)
t10 <- pcr_survey %>%
filter(child_contact_24_59m!=9999) %>%
group_by( Gender, season) %>%
summarize(N_contact_24_59m=sum(child_contact_24_59m, na.rm=T), N=n(), Pct=round(100*mean(child_contact_24_59m, na.rm=T),2))
t10 <- as_grouped_data(x = t10, groups = c("Gender"), columns = NULL)
flextable(t10)
t11 <- pcr_survey %>%
filter(child_contact_5_10y!=9999) %>%
group_by(Gender, season) %>%
summarize(N_contact_5_9y=sum(child_contact_5_10y, na.rm=T), N=n(), Pct=round(100*mean(child_contact_5_10y, na.rm=T),2))
t11 <- as_grouped_data(x = t11, groups = c("Gender"), columns = NULL)
flextable(t11)
t12 <- pcr_survey %>%
filter(child_contact_over10y!=9999) %>%
group_by( Gender,season) %>%
summarize(N_contact_10y_older=sum(child_contact_over10y, na.rm=T), N=n(), Pct=round(100*mean(child_contact_over10y, na.rm=T),2))
t12 <- as_grouped_data(x = t12, groups = c("Gender"), columns = NULL)
flextable(t12)
t13 <-  pcr_survey %>%
filter(child_contact != 9999) %>% #must answer question...lots of missing surveys in S1
mutate(child_contact_often = if_else(is.na(child_contact_often) |child_contact_often==999,0,child_contact_often) ) %>%
group_by(Gender, season,child_contact_often ) %>%
summarize(N=n()) %>%
ungroup() %>%
group_by(Gender,season) %>%
mutate(Percent= round(100*N/sum(N),2))
t13.t <- as_grouped_data(x = t13, groups = c("Gender", 'season'), columns = NULL)
flextable(t13.t)
d1 <- t13 %>%
filter( child_contact_often !=999) %>%
mutate(season= as.factor(season) , Gender=as.factor(Gender), child_contact_often=factor(child_contact_often,levels=c('0','1','2','3'), labels=c('None','Daily','Every few days','Few times/month') ))
d1.c <- dcast(d1, Gender + season ~child_contact_often ,value.var='Percent' )
d1.m <- melt(d1.c, id.vars=c('Gender','season')) %>%
mutate(value= if_else(is.na(value),0, value))
ggplot(d1.m, aes(x=season, stratum=variable,alluvium=variable,fill=variable,label=variable, y = value)) +
scale_fill_brewer(type = "qual", palette = "Set2") +
geom_flow(stat = "alluvium", lode.guidance = "frontback",
color = "darkgray") +
theme_classic()  +
facet_wrap(~Gender)
t13a <-  pcr_survey %>%
filter(child_contact_13_23m==1 | child_contact_24_59m==1 | child_contact_5_10y==1) %>% #must answer question...lots of missing surveys in S1
mutate(child_contact_often = if_else(is.na(child_contact_often) |child_contact_often==999,0,child_contact_often) ) %>%
group_by(Gender, season,child_contact_often ) %>%
summarize(N=n()) %>%
ungroup() %>%
group_by(Gender,season) %>%
mutate(Percent= round(100*N/sum(N),2))
d1 <- t13a %>%
mutate(season= as.factor(season) , Gender=as.factor(Gender), child_contact_often=factor(child_contact_often,levels=c('0','1','2','3'), labels=c('Missing','Daily','Every few days','Few times/month') ))
d1.c <- dcast(d1, Gender + season ~child_contact_often ,value.var='Percent' )
d1.m <- melt(d1.c, id.vars=c('Gender','season')) %>%
mutate(value= if_else(is.na(value),0, value))
ggplot(d1.m, aes(x=season, stratum=variable,alluvium=variable,fill=variable,label=variable, y = value)) +
scale_fill_brewer(type = "qual", palette = "Set2") +
geom_flow(stat = "alluvium", lode.guidance = "frontback",
color = "darkgray") +
theme_classic()  +
facet_wrap(~Gender) +
ggtitle('Frequency of contacts with 1-10y')
t14  <- pcr_survey %>%
filter(child_contact != 9999) %>% #must answer question...lots of missing surveys in S1 %>%
mutate(child_contact_hours = if_else(is.na(child_contact_hours) |child_contact_hours==999,0,child_contact_hours) ) %>%
group_by(Gender, season,child_contact_hours ) %>%
summarize(N=n()) %>%
ungroup() %>%
group_by(Gender,season) %>%
mutate(Percent= round(100*N/sum(N),2)) %>%
ungroup()
t14.t <- as_grouped_data(x = t14, groups = c("Gender", 'season'), columns = NULL)
flextable(t14.t)
d1 <- t14 %>%
filter(child_contact_hours !=999) %>%
mutate(season= as.factor(season) , Gender=as.factor(Gender), child_contact_hours=factor(child_contact_hours,levels=c('0','1','2','3'), labels=c('None','<4h','4-8h','>8h') ))
d1.c <- dcast(d1, Gender + season ~child_contact_hours ,value.var='Percent' )
d1.m <- melt(d1.c, id.vars=c('Gender','season')) %>%
mutate(value= if_else(is.na(value),0, value))
ggplot(d1.m, aes(x=season, stratum=variable,alluvium=variable,fill=variable,label=variable, y = value)) +
scale_fill_brewer(type = "qual", palette = "Set2") +
geom_flow(stat = "alluvium", lode.guidance = "frontback",
color = "darkgray") +
theme_classic()  +
facet_wrap(~Gender)
t14a  <- pcr_survey %>%
filter(child_contact_13_23m==1 | child_contact_24_59m==1 | child_contact_5_10y==1) %>% #must answer question...lots of missing surveys in S1 %>%
mutate(child_contact_hours = if_else(is.na(child_contact_hours) |child_contact_hours==999,0,child_contact_hours) ) %>%
group_by(Gender, season,child_contact_hours ) %>%
summarize(N=n()) %>%
ungroup() %>%
group_by(Gender,season) %>%
mutate(Percent= round(100*N/sum(N),2)) %>%
ungroup()
d1 <- t14a %>%
filter(child_contact_hours !=999) %>%
mutate(season= as.factor(season) , Gender=as.factor(Gender), child_contact_hours=factor(child_contact_hours,levels=c('0','1','2','3'), labels=c('Missing','<4h','4-8h','>8h') ))
d1.c <- dcast(d1, Gender + season ~child_contact_hours ,value.var='Percent' )
d1.m <- melt(d1.c, id.vars=c('Gender','season')) %>%
mutate(value= if_else(is.na(value),0, value))
ggplot(d1.m, aes(x=season, stratum=variable,alluvium=variable,fill=variable,label=variable, y = value)) +
scale_fill_brewer(type = "qual", palette = "Set2") +
geom_flow(stat = "alluvium", lode.guidance = "frontback",
color = "darkgray") +
theme_classic()  +
facet_wrap(~Gender) +
ggtitle('Intensity of contact ith kids 1-10y')
t13 <-  pcr_survey %>%
mutate(recent_runny_nose = if_else(is.na(recent_runny_nose) ,'9999',recent_runny_nose) ) %>%
group_by(Gender, season,recent_runny_nose ) %>%
summarize(N=n()) %>%
ungroup() %>%
group_by(Gender,season) %>%
mutate(Percent= round(100*N/sum(N),2))
t13.t <- as_grouped_data(x = t13, groups = c("Gender", 'season'), columns = NULL)
flextable(t13.t)
t13 <-  pcr_survey %>%
mutate(recent_covid_vax = if_else(is.na(recent_covid_vax) ,9999,recent_covid_vax) ) %>%
group_by(Gender, season,recent_covid_vax ) %>%
summarize(N=n()) %>%
ungroup() %>%
group_by(Gender,season) %>%
mutate(Percent= round(100*N/sum(N),2))
t13.t <- as_grouped_data(x = t13, groups = c("Gender", 'season'), columns = NULL)
flextable(t13.t)
t18 <- pcr_survey %>%
group_by(time, Household, season) %>%
summarize(N_pos_time=sum(piab_pos)) %>%
ungroup() %>%
group_by( season,N_pos_time) %>%
summarize(N=n())
t18 <- as_grouped_data(x = t18, groups = c('season'), columns = NULL)
flextable(t18)
t16  <- pcr_survey %>%
mutate(child_contact= if_else(is.na(child_contact)| child_contact==9999,9999,child_contact)) %>%
group_by( child_contact,  ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t16 <- as_grouped_data(x = t16, groups = c("child_contact"), columns = NULL)
flextable(t16)
t16  <- pcr_survey %>%
mutate(child_contact_u5 = if_else( (child_contact_u12m==1 |child_contact_13_23m==1 | child_contact_24_59m==1),1,0   ),
child_contact_u5= if_else(is.na(child_contact_u12m)| child_contact_u12m==9999,9999,child_contact_u5)) %>%
group_by( child_contact_u5 ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t16 <- as_grouped_data(x = t16, groups = c("child_contact_u5"), columns = NULL)
flextable(t16)
t16  <- pcr_survey %>%
group_by( child_contact_u12m ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t16 <- as_grouped_data(x = t16, groups = c("child_contact_u12m"), columns = NULL)
flextable(t16)
t16  <- pcr_survey %>%
group_by( child_contact_13_23m ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t16 <- as_grouped_data(x = t16, groups = c("child_contact_13_23m"), columns = NULL)
flextable(t16)
t16  <- pcr_survey %>%
group_by( child_contact_24_59m ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t16 <- as_grouped_data(x = t16, groups = c("child_contact_24_59m"), columns = NULL)
flextable(t16)
t16  <- pcr_survey %>%
group_by( child_contact_5_10y ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t16 <- as_grouped_data(x = t16, groups = c("child_contact_5_10y"), columns = NULL)
flextable(t16)
t16  <- pcr_survey %>%
group_by( child_contact_over10y ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t16 <- as_grouped_data(x = t16, groups = c("child_contact_over10y"), columns = NULL)
flextable(t16)
t17  <- pcr_survey %>%
mutate(child_contact_hours= if_else(is.na(child_contact_hours),999,child_contact_hours)) %>%
group_by(  child_contact_hours ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
#t17 <- as_grouped_data(x = t17, groups = c("season"), columns = NULL)
flextable(t17)
t17  <- pcr_survey %>%
group_by( child_contact_often ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
flextable(t17)
tab1 <- pcr_survey %>%
filter(child_contact_hours !=999 & child_contact_often !=999)
table(tab1$child_contact_hours)
table(tab1$child_contact_often)
table(tab1$child_contact_often, tab1$child_contact_hours)
t17  <- pcr_survey %>%
mutate(child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
group_by(Gender, child_contact_often ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t17 <- as_grouped_data(x = t17, groups = c("Gender"), columns = NULL)
flextable(t17)
t17  <- pcr_survey %>%
group_by(Gender, child_contact_hours ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t17 <- as_grouped_data(x = t17, groups = c("Gender"), columns = NULL)
flextable(t17)
t17  <- pcr_survey %>%
mutate( intensity_index = if_else(child_contact_hours==3 & child_contact_often==1,1,
if_else(child_contact_hours==3 & child_contact_often==2,2,
if_else(child_contact_hours==3 & child_contact_often==3,3,
if_else(child_contact_hours==2 & child_contact_often==1,4,
if_else(child_contact_hours==2 & child_contact_often==2,5,
if_else(child_contact_hours==2 & child_contact_often==3,6,
if_else(child_contact_hours==1 & child_contact_often==1,7,
if_else(child_contact_hours==1 & child_contact_often==2,8,
if_else(child_contact_hours==1 & child_contact_often==3,9,999)))))))))) %>%
group_by( intensity_index ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
#t17 <- as_grouped_data(x = t17, groups = c("Gender"), columns = NULL)
flextable(t17)
t16  <- pcr_survey %>%
group_by( Gender, season ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t16 <- as_grouped_data(x = t16, groups = c("Gender"), columns = NULL)
flextable(t16)
t16  <- pcr_survey %>%
mutate(child_contact_u10 = if_else( (child_contact_u12m==1 |child_contact_13_23m==1 | child_contact_24_59m==1 | child_contact_5_10y==1),1,0   ),
child_contact_u10= if_else(is.na(child_contact_u12m)| child_contact_u12m==9999,9999,child_contact_u10)) %>%
group_by( child_contact_u10,Gender ) %>%
summarize(N=n(), N_pos=sum(piab_pos), Pct_Pos=round(100*mean(piab_pos),1))
t16 <- as_grouped_data(x = t16, groups = c('child_contact_u10',"Gender"), columns = NULL)
flextable(t16)
pcr_survey %>%
filter(piab_pos==1) %>%
group_by(diabetes) %>%
summarize(piab=mean(piab))
pcr_survey %>%
filter(lyta_pos==1) %>%
group_by(diabetes) %>%
summarize(lyta=mean(lyta))
pcr_survey_mod <-  pcr_survey %>%
filter(child_contact_13_23m!=9999 & !is.na(piab_pos)) %>%
mutate( child_contact_13_23m = if_else(child_contact_13_23m==9999,0, child_contact_13_23m),
child_contact_24_59m = if_else(child_contact_24_59m==9999,0, child_contact_24_59m),
child_contact_5_10y = if_else(child_contact_5_10y==9999,0, child_contact_5_10y),
N_child_contact_1_10 = child_contact_13_23m + child_contact_24_59m + child_contact_5_10y,
child_contact_hours=as.factor(child_contact_hours),
child_contact_often =as.factor(child_contact_often))
mod1 <- glm(piab_pos ~ child_contact_u12m + child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y , family='binomial', data=pcr_survey_mod)
summary(mod1)
mod1 <- glm(piab_pos ~  child_contact_often  +  child_contact_24_59m + child_contact_5_10y  , family='binomial', data=pcr_survey_mod)
summary(mod1)
mod1 <- glm(piab_pos ~  diabetes +pneu_vax  +child_contact_often+child_contact_u12m + child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y, family='binomial', data=pcr_survey_mod)
summary(mod1)
mod1.gee <- gee(piab_pos ~ child_contact_u12m+ child_contact_13_23m + child_contact_24_59m + child_contact_5_10y + child_contact_over10y,id=pcr_survey$ID, data=pcr_survey_mod, family=binomial(link='log'), corstr="exchangeable")
mod.df <- pcr_survey_mod %>%
filter(child_contact_13_23m!=9999 & !is.na(piab_pos)) %>%
mutate(ID=as.factor(ID))
mod.df$child_contact_u5 <-
mod.df$child_contact_u12m + mod.df$child_contact_13_23m + mod.df$child_contact_24_59m
mod.df$child_contact_1_10 <-  mod.df$child_contact_13_23m + mod.df$child_contact_24_59m +
mod.df$child_contact_5_10y
#N contacts
mod.df$child_contact_1_5 <- mod.df$child_contact_13_23m + mod.df$child_contact_24_59m
l1 <- mod.df
l1$day <- 0
l1$day[l1$time==2] <- 14
l1$day[l1$time==3] <- 14*2
l1$day[l1$time==4] <- 14*3
l1$day[l1$time==5] <- 14*4
l1$day[l1$time==6] <- 14*5
l1$state <- NA
l1$state[l1$piab_pos==0 & !is.na(l1$piab_pos)] <- 1
l1$state[l1$piab_pos==1 & !is.na(l1$piab_pos)] <- 2
#l1$state <- as.factor(l1$state)
q1 <- rbind(c( 0,0.01),
c(0.01,0)
)
l1 <- l1[order(l1$ID, l1$day),]
l2 <- l1[, c('state','child_contact_u5','child_contact_1_5','child_contact','Gender','child_contact_u12m','child_contact_13_23m',"child_contact_24_59m","child_contact_5_10y",'child_contact_over10y','child_contact_1_10', 'ID','day', 'season','child_contact_often','child_contact_hours', 'diabetes')] %>%
mutate(child_contact_2_10y = if_else( (child_contact_24_59m==1 |child_contact_5_10y==1) & child_contact !=9999,1,
if_else(child_contact_24_59m==0  & child_contact_5_10y==0 & child_contact !=9999,0,
if_else(child_contact==9999 ,9999, 9999) ) )) %>%
mutate(diabetes=relevel(diabetes, ref='0'))
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2)
msm.mod0
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_13_23m ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_24_59m ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_5_10y ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_2_10y ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_13_23m + child_contact_24_59m + child_contact_5_10y ))
msm.mod1
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_1_5))
msm.mod1b
msm.mod1b <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_u5))
msm.mod1b
msm.mod1c <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ child_contact_1_10))
msm.mod1c
#clearance rate as a function of child contacts?
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list( "2-1" = ~ child_contact_1_10))
msm.mod1e
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list( "1-2" = ~ diabetes))
msm.mod0
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list( "2-1" = ~ diabetes))
msm.mod0
##IN THIS CODING, 1= FREQUENT CONTACT; 0 = LESS FREQUENT CONTACT, NO CONTACT, NO RESPONSE
l3 <- l2 %>%
mutate(child_contact_often1 =if_else(child_contact_often %in% c('1','2'),1,0),
child_contact_often2 =if_else(child_contact_often %in% c('3'),1,0)) %>%
filter(child_contact !=9999)
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l3)
msm.mod1e
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l3,covariates = list( "1-2" = ~ child_contact_often1 + child_contact_often2))
msm.mod1e
msm.mod1e <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l3,covariates = list( "1-2" = ~ child_contact_often1 , "2-1" = ~ child_contact_often1 ))
msm.mod1e
mod.df <- pcr_survey %>%
filter( !is.na(piab_pos)) %>%
mutate(ID=as.factor(ID))
recent_hh_col <- mod.df %>%
group_by(Household,time ) %>%
summarize(piab_pos=max(piab_pos)) %>%
mutate(time=time+1) %>%
rename(piab_pos_HH_prev = piab_pos)
recent_ID_col <- mod.df %>%
group_by(Household,ID,time ) %>%
summarize(piab_pos=sum(piab_pos)) %>%
mutate(time=time+1) %>%
rename(piab_pos_ID_prev = piab_pos)
#colonized_partner_prev is defined based on a positive household without positive individual on previous time
recent_col <- merge(recent_hh_col,recent_ID_col, by=c('Household', 'time') ) %>%
mutate(colonized_partner_prev = piab_pos_HH_prev - piab_pos_ID_prev)
mod.df <- merge(mod.df,recent_col, by=c('ID','Household', 'time'))
#N contacts
mod.df$child_contact_1_10 <- mod.df$child_contact_13_23m + mod.df$child_contact_24_59m  +mod.df$child_contact_5_10y
l1 <- mod.df
l1$day <- 0
l1$day[l1$time==2] <- 14
l1$day[l1$time==3] <- 14*2
l1$day[l1$time==4] <- 14*3
l1$day[l1$time==5] <- 14*4
l1$day[l1$time==6] <- 14*5
l1$state <- NA
l1$state[l1$piab_pos==0 & !is.na(l1$piab_pos)] <- 1
l1$state[l1$piab_pos==1 & !is.na(l1$piab_pos)] <- 2
#l1$state <- as.factor(l1$state)
q1 <- rbind(c( 0,0.01),
c(0.01,0)
)
l1 <- l1[order(l1$ID, l1$day),]
l2 <- l1[, c('state','Gender','child_contact_1_10', 'ID','day','colonized_partner_prev')]
table(l2$state, l2$colonized_partner_prev)
l3 <- l2 %>% filter(ID != 'S2_84')
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l3,covariates = list("1-2" = ~ colonized_partner_prev ))
msm.mod1
mod.df <- pcr_survey %>%
filter( !is.na(lyta_pos)) %>%
mutate(ID=as.factor(ID))
recent_hh_col <- mod.df %>%
group_by(Household,time ) %>%
summarize(lyta_pos=max(lyta_pos)) %>%
mutate(time=time+1) %>%
rename(lyta_pos_HH_prev = lyta_pos)
recent_ID_col <- mod.df %>%
group_by(Household,ID,time ) %>%
summarize(lyta_pos=sum(lyta_pos)) %>%
mutate(time=time+1) %>%
rename(lyta_pos_ID_prev = lyta_pos)
#colonized_partner_prev is defined based on a positive household without positive individual on previous time
recent_col <- merge(recent_hh_col,recent_ID_col, by=c('Household', 'time') ) %>%
mutate(colonized_partner_prev = lyta_pos_HH_prev - lyta_pos_ID_prev)
mod.df <- merge(mod.df,recent_col, by=c('ID','Household', 'time'))
#N contacts
mod.df$child_contact_1_10 <- mod.df$child_contact_13_23m + mod.df$child_contact_24_59m  +mod.df$child_contact_5_10y
l1 <- mod.df
l1$day <- 0
l1$day[l1$time==2] <- 14
l1$day[l1$time==3] <- 14*2
l1$day[l1$time==4] <- 14*3
l1$day[l1$time==5] <- 14*4
l1$day[l1$time==6] <- 14*5
l1$state <- NA
l1$state[l1$lyta_pos==0 & !is.na(l1$lyta_pos)] <- 1
l1$state[l1$lyta_pos==1 & !is.na(l1$lyta_pos)] <- 2
#l1$state <- as.factor(l1$state)
q1 <- rbind(c( 0,0.01),
c(0.01,0)
)
l1 <- l1[order(l1$ID, l1$day),]
l2 <- l1[, c('state','Gender','child_contact_1_10', 'ID','day','colonized_partner_prev', 'diabetes')] %>%
mutate(diabetes= relevel(diabetes, ref='0')) %>%
filter(ID !='S2_84')
table(l2$state, l2$colonized_partner_prev)
msm.mod0 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2 )
msm.mod0
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ colonized_partner_prev ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("1-2" = ~ diabetes ))
msm.mod1
msm.mod1 <- msm( state~ day ,  subject=ID , qmatrix=q1 , data=l2,covariates = list("2-1" = ~ diabetes ))
msm.mod1
