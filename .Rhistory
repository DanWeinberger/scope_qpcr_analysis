t5 <- pcr_survey %>%
group_by(diabetes) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(diabetes = if_else(is.na(diabetes),999, diabetes))
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
diabetes <- pcr_survey %>%
group_by(Household) %>%
mutate(hh_diabetes=max(diabetes)) %>%
filter(hh_diabetes>=1) %>%
select(ID, Household, diabetes, lyta, piab, piab)
diabetes <- pcr_survey %>%
group_by(Household) %>%
mutate(hh_diabetes=max(diabetes)) %>%
filter(hh_diabetes>=1) %>%
select(ID, Household, diabetes, lyta, piab, piab_pos)
View(diabetes)
t5 <- pcr_survey %>%
group_by(diabetes)
View(t5)
diabetes <- pcr_survey %>%
group_by(Household) %>%
mutate(hh_diabetes=max(diabetes, na.rm=T)) %>%
filter(hh_diabetes>=1) %>%
select(ID, Household, diabetes, lyta, piab, piab_pos)
diabetes <- pcr_survey %>%
group_by(Household) %>%
mutate(hh_diabetes=sum(diabetes, na.rm=T)) %>%
filter(hh_diabetes>=1) %>%
select(ID, Household, diabetes, lyta, piab, piab_pos)
write.csv(diabetes, './Data/diabetes.csv')
diabetes <- pcr_survey %>%
group_by(Household) %>%
mutate(hh_diabetes=sum(diabetes, na.rm=T)) %>%
filter(hh_diabetes>=1) %>%
select(ID, Household, diabetes, lyta, piab, piab_pos) %>%
ungroup() %>%
group_by(ID, Household) %>%
summarize(piab=mean(piab, na.rm=T), lyta=mean(lyta, na.rm=T))
View(diabetes)
write.csv(diabetes, './Data/diabetes.csv')
s2_surv <- read.csv('./Data/confidential/Season_2_Surveys/fornightly_DATA_2022-09-19.csv') %>%
rename(scope_id=participant_id,
child_contact=child_contact_2weeks,
child_contact_u12m=child_contact_age___1,
child_contact_13_23m=child_contact_age___2,
child_contact_24_59m=child_contact_age___3,
child_contact_5_10y=child_contact_age___4,
child_contact_over10y=child_contact_age___5,
activity_community_center=activities_describe___1,
activity_friends=activities_describe___2,
activity_family=activities_describe___3,
acitivity_fitness=activities_describe___4,
activity_other=activities_describe___5
) %>%
mutate(ID = paste0('S2_',gsub("\\..*","",floor(scope_id))) , time=visit_number)
table(s2_surv$visit_number)
d1.ds <- readRDS( './Data/PCR_compiled.rds')
s1_demographics <- readRDS('./Data/confidential/s1_baseline_vars.rds') %>%
rename(`season 1 scope ID`=ID, Age=Age2, Gender=Gender2, Race=Race2,Ethnicity=Ethnicity2) %>%
mutate(`season 1 scope ID`=as.numeric(`season 1 scope ID`)) %>%
dplyr::select(-MRN_cleaned)
s2_demographics_b <- read_excel('./Data/confidential/New Participants SCOPE_season 2.xlsx', sheet='repeat participant cheat sheet')
s2_demographics_b2 <- left_join(s2_demographics_b,s1_demographics, by="season 1 scope ID") %>%
rename(ID=`season 2 scope ID`, s1_match=`season 1 scope ID`) %>%
rename(pneu_vax1=pneu_vax,
immuno_meds1=immuno,
diabetes_meds1=diabetes,
asthma_meds1=asthma,
flu_shot1=flu_shot
) %>%
mutate(s1_match = paste0('S1_',s1_match),
pneu_vax = if_else(pneu_vax1=='Yes',1,
if_else(pneu_vax1=='No',0, NA_real_)),
flu_shot = if_else(flu_shot1=='Yes',1,
if_else(flu_shot1=='No',2, NA_real_)),
asthma = if_else(asthma_meds1=='Yes',1,
if_else(asthma_meds1=='No',2, NA_real_)),
diabetes = if_else(diabetes_meds1=='Yes',1,
if_else(diabetes_meds1=='No',2, NA_real_)),
smoke = if_else(current_smoke=='Yes, cigarettes',1,
if_else(current_smoke=='No',2, NA_real_))
) %>%
select(ID, s1_match,Age, Gender, Race, Ethnicity, smoke,pneu_vax,pneu_vax_date, education , diabetes,asthma, flu_shot )
s2_demographics_a <- read_excel('./Data/confidential/New Participants SCOPE_season 2.xlsx', sheet='new participants season 2') %>%
rename(ID = `scope ID`, Race = `How would you describe your ethnicity?`,
Ethnicity = `Would you consider yourself Hispanic or Non-Hispanic?`,
dob= `What is your date of birth?`,
pneu_vax_date= pcv_date,
pneu_vax=pcv
) %>%
mutate(Age = lubridate::time_length(difftime(as.Date('2022-01-01'), dob), "years"), pneu_vax_date=as.character(pneu_vax_date) ) %>%
select(ID, Age, Gender, Race, Ethnicity, education, weight, height, pneu_vax, pneu_vax_date, flu_shot, flu_shot_when,
diabetes, asthma, smoke, number_cigarettes, smoked, quit_smoking) #chronic_heart_disease,congestive_heart_failure,enlarged_or_thick_heart,chronic_liver_disease,liver_cirrhosis,liver_cancer,chronic_lung_disease,chronic_obstructive_pulm,emphysema,
s2_demographics <- bind_rows(s2_demographics_a, s2_demographics_b2) %>%
mutate(ID= paste0('S2_',ID))
s2_pcr <- d1.ds[grep('S2', d1.ds$ID),]
View(d1.ds)
names(pcr_survey)
diabetes <- pcr_survey %>%
group_by(Household) %>%
mutate(hh_diabetes=sum(diabetes, na.rm=T)) %>%
filter(hh_diabetes>=1) %>%
select(ID,time, Household, diabetes, lyta, piab, piab_pos) %>%
ungroup() %>%
group_by(ID,time, Household) %>%
summarize(piab=mean(piab, na.rm=T), lyta=mean(lyta, na.rm=T))
write.csv(diabetes, './Data/diabetes.csv')
t5 <- pcr_survey %>%
group_by(diabetes) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(diabetes = if_else(is.na(diabetes),999, diabetes))
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
diabetes <- pcr_survey %>%
group_by(Household) %>%
mutate(hh_diabetes=sum(diabetes, na.rm=T)) %>%
filter(hh_diabetes>=1) %>%
select(ID,time, Household, diabetes, lyta, piab, piab_pos) %>%
ungroup() %>%
group_by(ID,time, Household, idabetes) %>%
summarize(piab=mean(piab, na.rm=T), lyta=mean(lyta, na.rm=T))
diabetes <- pcr_survey %>%
group_by(Household) %>%
mutate(hh_diabetes=sum(diabetes, na.rm=T)) %>%
filter(hh_diabetes>=1) %>%
select(ID,time, Household, diabetes, lyta, piab, piab_pos) %>%
ungroup() %>%
group_by(ID,time, Household, diabetes) %>%
summarize(piab=mean(piab, na.rm=T), lyta=mean(lyta, na.rm=T))
write.csv(diabetes, './Data/diabetes.csv')
t5 <- pcr_survey %>%
group_by(ID) %>%
mutate(diabetes=max(diabetes)) %>%
group_by(diabetes) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(diabetes = if_else(is.na(diabetes),999, diabetes))
t5 <- pcr_survey %>%
group_by(ID) %>%
mutate(diabetes=max(diabetes)) %>%
ungroup() %>%
group_by(diabetes) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(diabetes = if_else(is.na(diabetes),999, diabetes))
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
t5 <- pcr_survey %>%
group_by(ID) %>%
mutate(diabetes=max(diabetes, na.rm=T)) %>%
ungroup() %>%
group_by(diabetes) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(diabetes = if_else(is.na(diabetes),999, diabetes))
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
?if_else
t5 <- pcr_survey %>%
group_by(ID) %>%
mutate(diabetes=sum(diabetes, na.rm=T), diabetes=if_else(diabetes>1,1,0)) %>%
ungroup() %>%
group_by(diabetes) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) ) %>%
mutate(diabetes = if_else(is.na(diabetes),999, diabetes))
t5 <- as_grouped_data(x = t5, groups = c("diabetes"), columns = NULL)
flextable(t5)
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
options(dplyr.summarise.inform = FALSE)
library(ggplot2)
library(ggalluvial)
library(kableExtra)
library(knitr)
library(readxl)
library(gee)
library(reshape2)
library(flextable)
library(msm)
library(patchwork)
library(gridExtra)
library(pheatmap)
library(RColorBrewer)
library(table1)
source('heat.fun.R')
source('heat.fun.contact.R')
source('./R/clean_pcr.R')
source('./R/clean_s1_surveys.R')
source('./R/clean_s2_surveys.R')
clean_pcr <- clean_pcr_fun()
pcr_summary_long <- readRDS('./Data/PCR_compiled.rds')
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2),
Gender=if_else(ID=='S2_77' & is.na(Gender), 'F',Gender))
diabetes <- pcr_survey %>%
group_by(Household) %>%
mutate(hh_diabetes=sum(diabetes, na.rm=T)) %>%
filter(hh_diabetes>=1) %>%
select(ID,time, Household, diabetes, lyta, piab, piab_pos) %>%
ungroup() %>%
group_by(ID,time, Household, diabetes) %>%
summarize(piab=mean(piab, na.rm=T), lyta=mean(lyta, na.rm=T))
write.csv(diabetes, './Data/diabetes.csv')
diabetes
unique.age <- pcr_survey %>%
group_by(ID) %>%
summarize(Age=mean(Age, na.rm=T))
hist(unique.age$Age, main='Distribution of ages', xlab='Age(y)')
unique.age %>%
summarize(mean=mean(Age, na.rm=T), min=min(Age, na.rm=T), max=max(Age, na.rm=T))
first_visit <- pcr_survey %>% filter(time==1) %>%
mutate(Race=tolower(Race), Ethnicity=tolower(Ethnicity), smoke=as.factor(smoke), pneu_vax=as.factor(pneu_vax), flu_shot=as.factor(flu_shot) , diabetes=as.factor(diabetes), asthma=as.factor(asthma),
education=toupper(education),
education_level= if_else(grepl('HIGH', education) |
grepl("GED",education) , 'HS',
if_else(grepl('BACHELOR', education) |
grepl('COLLEGE', education)|
grepl('ASSOCIATE', education)|
grepl('BA', education) ,'Undergrad',
if_else(grepl('MASTER', education)|
grepl('GRADUATE', education)|
grepl('MBA', education)|
grepl('PHD', education)|
grepl('JD', education)|
grepl('J.D.', education)|
grepl('MPH', education)|
grepl('MD', education)|
grepl('DOCTORATE', education), 'Graduate', 'Unknown')))
)
tab1 <- table1( ~Age + Gender + Race +Ethnicity + activity_family + activity_friends + activity_community_center +  smoke+ diabetes + asthma + pneu_vax + flu_shot +education_level , data=first_visit)
tab1 <- as.data.frame(tab1)
flextable(tab1)
t1 <- pcr_summary_long %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0)) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), `Percent piab`=round(mean(piab_pos)*100,2) )
flextable(t1)
t1 <- pcr_summary_long %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0)) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(),
N_lytA= sum(lyta_pos),
`Percent piab`=round(mean(piab_pos)*100,2),
`Percent lyta`=round(mean(lyta_pos)*100,2)
)
flextable(t1)
t2 <- pcr_summary_long %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0), season=substr(ID,1,2)) %>%
group_by(season) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1) )
flextable(t2)
t2 <- pcr_summary_long %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0), season=substr(ID,1,2)) %>%
group_by(season) %>%
summarize(N_piaB= sum(piab_pos), N_test= n(), Pct_piab=round(mean(piab_pos)*100,1),Pct_lyta=round(mean(lyta_pos)*100,1) )
flextable(t2)
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
options(dplyr.summarise.inform = FALSE)
library(ggplot2)
library(ggalluvial)
library(kableExtra)
library(knitr)
library(readxl)
library(gee)
library(reshape2)
library(flextable)
library(msm)
library(patchwork)
library(gridExtra)
library(pheatmap)
library(RColorBrewer)
library(table1)
source('heat.fun.R')
source('heat.fun.contact.R')
source('./R/clean_pcr.R')
source('./R/clean_s1_surveys.R')
source('./R/clean_s2_surveys.R')
clean_pcr <- clean_pcr_fun()
pcr_summary_long <- readRDS('./Data/PCR_compiled.rds')
pcr_survey <- readRDS('./Data./pcr_survey_combined.rds') %>%
mutate(Gender = if_else(Gender %in% c('F','Female'),'F',Gender),
Gender = if_else(Gender %in% c('M','Male'),'M',Gender),
child_contact_often= if_else(is.na(child_contact_often),999,child_contact_often)) %>%
filter(piab != 9999) %>%
mutate(piab_pos = if_else(piab < 40,1,0),
lyta_pos = if_else(lyta < 40,1,0),
season=substr(ID,1,2),
Gender=if_else(ID=='S2_77' & is.na(Gender), 'F',Gender))
diabetes <- pcr_survey %>%
group_by(Household) %>%
mutate(hh_diabetes=sum(diabetes, na.rm=T)) %>%
filter(hh_diabetes>=1) %>%
select(ID,time, Household, diabetes, lyta, piab, piab_pos) %>%
ungroup() %>%
group_by(ID,time, Household, diabetes) %>%
summarize(piab=mean(piab, na.rm=T), lyta=mean(lyta, na.rm=T))
write.csv(diabetes, './Data/diabetes.csv')
unique.age <- pcr_survey %>%
group_by(ID) %>%
summarize(Age=mean(Age, na.rm=T))
hist(unique.age$Age, main='Distribution of ages', xlab='Age(y)')
unique.age %>%
summarize(mean=mean(Age, na.rm=T), min=min(Age, na.rm=T), max=max(Age, na.rm=T))
first_visit <- pcr_survey %>% filter(time==1) %>%
mutate(Race=tolower(Race), Ethnicity=tolower(Ethnicity), smoke=as.factor(smoke), pneu_vax=as.factor(pneu_vax), flu_shot=as.factor(flu_shot) , diabetes=as.factor(diabetes), asthma=as.factor(asthma),
education=toupper(education),
education_level= if_else(grepl('HIGH', education) |
grepl("GED",education) , 'HS',
if_else(grepl('BACHELOR', education) |
grepl('COLLEGE', education)|
grepl('ASSOCIATE', education)|
grepl('BA', education) ,'Undergrad',
if_else(grepl('MASTER', education)|
grepl('GRADUATE', education)|
grepl('MBA', education)|
grepl('PHD', education)|
grepl('JD', education)|
grepl('J.D.', education)|
grepl('MPH', education)|
grepl('MD', education)|
grepl('DOCTORATE', education), 'Graduate', 'Unknown')))
)
tab1 <- table1( ~Age + Gender + Race +Ethnicity + activity_family + activity_friends + activity_community_center +  smoke+ diabetes + asthma + pneu_vax + flu_shot +education_level , data=first_visit)
tab1 <- as.data.frame(tab1)
flextable(tab1)
p1 <- ggplot(pcr_summary_long,aes(x=lyta, y=piab, alpha=0.5))+
theme_classic() +
geom_point() +
ylim(45,10) +
xlim(45,10)+
xlab('lytA') +
ylab('piaB') +
theme(legend.position = "none") +
geom_abline(col='gray', lty=2) +
geom_hline(yintercept=40,col='gray', lty=3)+
geom_vline(xintercept=40,col='gray', lty=3)
p1
#ds1 <- data.array[target,,]
ds1 <- clean_pcr$clean_pcr
ds1$lyta[ds1$lyta==9999] <- NA
ds1$piab[ds1$piab==9999] <- NA
ds1 <- ds1 %>%
filter(ID !='S2_NA')
breakslist<-seq(cut1,cut2,by=1)
weeks<- paste0('Week ', c(0,2,4,6,8,10))
ds1$season <- substr(ds1$ID,1,2)
ds1$seasonid <- as.numeric(substring(ds1$ID, 4))
target='piab'
ds1 <- clean_pcr$clean_pcr
ds1$lyta[ds1$lyta==9999] <- NA
ds1$piab[ds1$piab==9999] <- NA
ds1 <- ds1 %>%
filter(ID !='S2_NA')
breakslist<-seq(cut1,cut2,by=1)
cut1=15
cut2=45
cut3 = 47
breakslist<-seq(cut1,cut2,by=1)
weeks<- paste0('Week ', c(0,2,4,6,8,10))
ds1$season <- substr(ds1$ID,1,2)
ds1$seasonid <- as.numeric(substring(ds1$ID, 4))
ds1$seasonhh <- as.numeric(substring(ds1$Household, 4))
ds1 <- ds1 %>%
group_by(season, seasonid, seasonhh) %>%
mutate(sampleID=cur_group_id()) %>%
ungroup() %>%
group_by(season,seasonhh) %>%
mutate(house=group_indices()) %>%
ungroup() %>%
arrange(season,seasonhh, seasonid)
ds.plot <- dcast(ds1, house+sampleID + season + seasonid + seasonhh +HH_order~time, value.var = target)
ds1 <- clean_pcr$clean_pcr
ds1$lyta[ds1$lyta==9999] <- NA
ds1$piab[ds1$piab==9999] <- NA
ds1 <- ds1 %>%
filter(ID !='S2_NA')
breakslist<-seq(cut1,cut2,by=1)
weeks<- paste0('Week ', c(0,2,4,6,8,10))
ds1$season <- substr(ds1$ID,1,2)
ds1$seasonid <- as.numeric(substring(ds1$ID, 4))
ds1$seasonhh <- as.numeric(substring(ds1$Household, 4))
ds1 <- ds1 %>%
group_by(season, seasonid, seasonhh) %>%
mutate(sampleID=cur_group_id()) %>%
ungroup() %>%
group_by(season,seasonhh) %>%
mutate(house=group_indices()) %>%
ungroup() %>%
arrange(season,seasonhh, seasonid)
ds.plot <- dcast(ds1, house+sampleID + season + seasonid + seasonhh +HH_order~time, value.var = target)
ds.plot <- ds.plot %>%
ds.plot <- ds.plot %>%
filter(!is.na(sampleID))
ds1 <- clean_pcr$clean_pcr
ds1$lyta[ds1$lyta==9999] <- NA
ds1$piab[ds1$piab==9999] <- NA
ds1 <- ds1 %>%
filter(ID !='S2_NA')
breakslist<-seq(cut1,cut2,by=1)
weeks<- paste0('Week ', c(0,2,4,6,8,10))
ds1$season <- substr(ds1$ID,1,2)
ds1$seasonid <- as.numeric(substring(ds1$ID, 4))
ds1$seasonhh <- as.numeric(substring(ds1$Household, 4))
ds1 <- ds1 %>%
group_by(season, seasonid, seasonhh) %>%
mutate(sampleID=cur_group_id()) %>%
ungroup() %>%
group_by(season,seasonhh) %>%
mutate(house=group_indices()) %>%
ungroup() %>%
arrange(season,seasonhh, seasonid)
ds.plot <- dcast(ds1, house+sampleID + season + seasonid + seasonhh +HH_order~time, value.var = target)
ds.plot <- ds.plot %>%
filter(!is.na(sampleID))
ds.plot$labels <- paste(ds.plot$season, ds.plot$seasonid, sep='_')
sub1 <- ds.plot[1:cut3,]
gap1 <- which(sub1$HH_order==1) +1
gap1 <- gap1[-length(gap1)]
View(ds.plot)
write.csv('./Data/heat.table.csv')
write.csv(ds.plot,'./Data/heat.table.csv')
knitr::opts_chunk$set(echo = F)
library(dplyr)
library(ggplot2)
library(plotly)
#library(d3heatmap)
library(viridis)
library(hrbrthemes)
library(stringr)
library(heatmaply)
source('./R/plot.func.addition.R')
# key0 <-  read.table(file = './Data/Strain.clone.info.tsv', sep = '\t', header = TRUE) %>%
#   dplyr::rename(parent_ST=ID, new_ST=Strain , strain=Hartwell)
key1 <-  readxl::read_excel('./Data/PathogenWatch/Pathogen Watch Output (Capsule Switch Mutants).xlsx') %>%
dplyr::rename(straininfo=`Capsule Switch Isolate`,strain=`Genome Name`) %>%
mutate(parent_ST= sub("::.*", "", straininfo),
parent_ST=  gsub("∆cps", "", parent_ST),
new_ST= sub(".*::(\\S+) .*", "\\1", straininfo),
Clone=extracted_text <- sub("^[^ ]+ (.*)", "\\1", straininfo,
)
)%>%  dplyr::select(strain,parent_ST,new_ST,Clone)
g0 <- read.table(file = './Data/Pangenome.gene.presence.absence.tsv', sep = '\t', header = TRUE) %>%
mutate(Cps.gene.name = if_else(is.na(Cps.gene.name), Gene.cluster, Cps.gene.name),
gene_name_cluster= paste(Cps.gene.name,Gene.cluster, sep='_'),
gene_cluster_no_numb = ifelse(grepl('_', Gene.cluster), str_extract(Gene.cluster,  "^(.*?)(?=_)"), Gene.cluster
)
)%>%
group_by(gene_cluster_no_numb) %>%
arrange(Gene.cluster) %>%
mutate(index=row_number(),
Gene.cluster2=paste(gene_cluster_no_numb, index, sep='_')) %>%
ungroup()
g2.labs <- key1$strain[key1$parent_ST=='15B/C']
g3.labs <- key1$strain[key1$parent_ST=='22F']
# g1 <- g0 %>%
#   dplyr::select( gene_name_cluster, all_of(intersect(g1.labs, names(g0)))) %>%
#   reshape2::melt(., id.vars=c('gene_name_cluster')) %>%
#   reshape2::dcast(variable ~ gene_name_cluster)
#
# row.names(g1) <- g1$variable
# g1 <- g1 %>%   select(-variable)
#
# prev_acq_g1 <- apply(g1, 2,mean)
# g1 <- g1[,prev_acq_g1>0 & prev_acq_g1<1]
##same for g2
g2 <- g0 %>%
dplyr::select( Gene.cluster2, all_of(intersect(g2.labs, names(g0)))) %>%
reshape2::melt(., id.vars=c('Gene.cluster2')) %>%
reshape2::dcast(variable ~ Gene.cluster2)
row.names(g2) <- g2$variable
g2 <- g2 %>%   select(-variable)
prev_acq_g2 <- apply(g2, 2,mean)
cutoff <- 2/nrow(g2)
g2 <- g2[,prev_acq_g2>=cutoff & prev_acq_g2<= (1-cutoff)]
##same for g3
g3 <- g0 %>%
dplyr::select( Gene.cluster2, all_of(intersect(g3.labs, names(g0)))) %>%
reshape2::melt(., id.vars=c('Gene.cluster2')) %>%
reshape2::dcast(variable ~ Gene.cluster2)
row.names(g3) <- g3$variable
g3 <- g3 %>%   select(-variable)
prev_acq_g3 <- apply(g3, 2,mean)
cutoff <- 3/nrow(g2) #must be different in at least 2 strains
g3 <- g3[,prev_acq_g3>=cutoff & prev_acq_g3<= (1-cutoff)]
a1 <- read.table(file = './Data/Genes.with.annotations.tsv', sep = '\t', header = TRUE) %>%
dplyr::rename(Gene=Gene.cluster) %>%
mutate(Gene= gsub('~~~~~~','......', fixed=T, Gene ),
Non.unique.Gene.name = gsub(';','',Non.unique.Gene.name,fixed=T),
Non.unique.Gene.name = if_else(Non.unique.Gene.name=='', Gene,Non.unique.Gene.name )) %>%
#filter(Non.unique.Gene.name!='') %>%
arrange(Non.unique.Gene.name) %>%
group_by(Non.unique.Gene.name) %>%
mutate(Gene.cluster2 = paste0(Non.unique.Gene.name,'_', row_number()),
Cps.Gene = if_else(Cps.gene.name!='',1,0),
gene_name_cluster= paste(Gene, Non.unique.Gene.name, sep='_')
) %>%
ungroup() %>%
dplyr::select(Gene.cluster2,Cps.Gene,gene_name_cluster, Gene,Non.unique.Gene.name,Cps.gene.name ,Sequence)
p2 <- plot.func.addition(g2)
p3 <- plot.func.addition(g3)
View(g2)
