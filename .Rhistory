breaks=breakslist,
legend=F,
labels_col = weeks)
sub4 <- ds.plot[(cut5+1):nrow(ds.plot),]
cut4 <- which(sub4$hh_order==1) +1
cut4 <- cut4[-length(cut4)]
heat4<-pheatmap(sub4[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = cut4,
labels_row = sub4$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=T,
labels_col = weeks)
tiff(paste("Heat", target,".tiff"), width=4, height=8, unit='in', res=200)
grid.arrange(heat1[[4]],heat2[[4]],heat3[[4]],heat4[[4]],ncol=2)
dev.off()
sub2 <- ds.plot[(cut3+1):cut4,]
(cut3+1):cut4
cut3+1
cut3
cut3 = 47
cut4=94
cut5=141
gap3 <- which(sub3$hh_order==1) +1
gap3 <- gap3[-length(gap3)]
gap3
cut2=45
cut1=15
cut3 = 47
cut4=94
cut5=141
ds1 <- d1.ds
ds1$lyta[ds1$lyta==9999] <- NA
ds1$piab[ds1$piab==9999] <- NA
breakslist<-seq(cut1,cut2,by=1)
weeks<- paste0('Week ', 1:6)
ds1$house <- as.numeric(as.factor(ds1$Household))
ds1$sampleID <- as.numeric(as.factor(ds1$ID))
ds.plot <- dcast(ds1, house+sampleID~time, value.var = target)
ds.plot <- ds.plot %>%
group_by(house) %>%
arrange(sampleID) %>%
mutate(hh_order=row_number()) %>%
ungroup() %>%
arrange(house, sampleID)
sub1 <- ds.plot[1:cut3,]
gap1 <- which(sub1$hh_order==1) +1
gap1 <- gap1[-length(gap1)]
#First half
heat1 <- (pheatmap(sub1[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap1,
labels_row = sub1$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks))
sub2 <- ds.plot[(cut3+1):cut4,]
gap2 <- which(sub2$hh_order==1) +1
gap2 <- gap2[-length(gap2)]
heat2<-pheatmap(sub2[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap2,
labels_row = sub2$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks)
sub3 <- ds.plot[(cut4+1):cut5,]
gap3 <- which(sub3$hh_order==1) +1
gap3 <- gap3[-length(gap3)]
heat3<-pheatmap(sub3[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap3,
labels_row = sub3$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks)
sub4 <- ds.plot[(cut5+1):nrow(ds.plot),]
gap4 <- which(sub4$hh_order==1) +1
gap4 <- gap4[-length(gap4)]
heat4<-pheatmap(sub4[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap4,
labels_row = sub4$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=T,
labels_col = weeks)
grid.arrange(heat1[[4]],heat2[[4]],heat3[[4]],heat4[[4]],ncol=2)
grid.arrange(heat1[[4]],heat2[[4]],heat3[[4]],heat4[[4]],ncol=4)
as.factor(ds1$Household
)
names(ds1)
View(ds1$ID)
ds1$season <- substr(ds1$ID,1,2)
ds1$season
ds1$seasonid <- substring(ds1$ID, 4)
ds1$seasonid
ds1$seasonid <- as.numeric(substring(ds1$ID, 4))
?arrange
ds1$Household
ds1$seasonhh <- as.numeric(substring(ds1$Household, 4))
ds1 <- arrange(ds1, season,seasonhh, seasonid)
View(ds1)
?group_indices
ds1$sampleID <- ds1 %>% group_by(season, seasonid, seasonhh) %>% group_indices()
ds.plot <- dcast(ds1, house+sampleID + season + seasonid + seasonhh~time, value.var = target)
View(ds.plot)
ds1 <- d1.ds
ds1$lyta[ds1$lyta==9999] <- NA
ds1$piab[ds1$piab==9999] <- NA
breakslist<-seq(cut1,cut2,by=1)
weeks<- paste0('Week ', 1:6)
ds1$season <- substr(ds1$ID,1,2)
ds1$seasonid <- as.numeric(substring(ds1$ID, 4))
ds1$seasonhh <- as.numeric(substring(ds1$Household, 4))
ds1$sampleID <- ds1 %>% group_by(season, seasonid, seasonhh) %>% group_indices()
ds1 <- arrange(ds1, season,seasonhh, seasonid)
#ds1$house <- as.numeric(as.factor(ds1$Household))
ds.plot <- dcast(ds1, house+sampleID + season + seasonid + seasonhh~time, value.var = target)
ds1 <- ds1 %>%
group_by(season, seasonid, seasonhh) %>%
mutate(sampleID=group_indices()) %>%
ungroup() %>%
group_by(season,seasonhh) %>%
mutate(house=group_indices()) %>%
ungroup() %>%
arrange(season,seasonhh, seasonid)
ds1 <- ds1 %>%
group_by(season, seasonid, seasonhh) %>%
mutate(sampleID=cur_group_id()) %>%
ungroup() %>%
group_by(season,seasonhh) %>%
mutate(house=group_indices()) %>%
ungroup() %>%
arrange(season,seasonhh, seasonid)
ds1 <- d1.ds
ds1$lyta[ds1$lyta==9999] <- NA
ds1$piab[ds1$piab==9999] <- NA
breakslist<-seq(cut1,cut2,by=1)
weeks<- paste0('Week ', 1:6)
ds1$season <- substr(ds1$ID,1,2)
ds1$seasonid <- as.numeric(substring(ds1$ID, 4))
ds1$seasonhh <- as.numeric(substring(ds1$Household, 4))
ds1 <- ds1 %>%
group_by(season, seasonid, seasonhh) %>%
mutate(sampleID=cur_group_id()) %>%
ungroup() %>%
group_by(season,seasonhh) %>%
mutate(house=group_indices()) %>%
ungroup() %>%
arrange(season,seasonhh, seasonid)
View(ds1)
ds.plot <- dcast(ds1, house+sampleID + season + seasonid + seasonhh~time, value.var = target)
ds1 <- d1.ds
ds1$lyta[ds1$lyta==9999] <- NA
ds1$piab[ds1$piab==9999] <- NA
breakslist<-seq(cut1,cut2,by=1)
weeks<- paste0('Week ', 1:6)
ds1$season <- substr(ds1$ID,1,2)
ds1$seasonid <- as.numeric(substring(ds1$ID, 4))
ds1$seasonhh <- as.numeric(substring(ds1$Household, 4))
ds1 <- ds1 %>%
group_by(season, seasonid, seasonhh) %>%
mutate(sampleID=cur_group_id()) %>%
ungroup() %>%
group_by(season,seasonhh) %>%
mutate(house=group_indices()) %>%
ungroup() %>%
arrange(season,seasonhh, seasonid)
ds.plot <- dcast(ds1, house+sampleID + season + seasonid + seasonhh~time, value.var = target)
sub1 <- ds.plot[1:cut3,]
gap1 <- which(sub1$hh_order==1) +1
gap1 <- gap1[-length(gap1)]
#First half
heat1 <- (pheatmap(sub1[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap1,
labels_row = sub1$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks))
ds.plot <- dcast(ds1, house+sampleID + season + seasonid + seasonhh +HH_order~time, value.var = target)
sub1 <- ds.plot[1:cut3,]
gap1 <- which(sub1$hh_order==1) +1
gap1 <- gap1[-length(gap1)]
#First half
heat1 <- (pheatmap(sub1[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap1,
labels_row = sub1$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks))
heat1
gap1 <- which(sub1$HH_order==1) +1
gap1 <- gap1[-length(gap1)]
#First half
heat1 <- (pheatmap(sub1[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap1,
labels_row = sub1$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks))
#First half
heat1 <- (pheatmap(sub1[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap1,
labels_row = sub1$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks))
sub2 <- ds.plot[(cut3+1):cut4,]
gap2 <- which(sub2$HH_order==1) +1
gap2 <- gap2[-length(gap2)]
heat2<-pheatmap(sub2[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap2,
labels_row = sub2$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks)
sub3 <- ds.plot[(cut4+1):cut5,]
gap3 <- which(sub3$HH_order==1) +1
gap3 <- gap3[-length(gap3)]
heat3<-pheatmap(sub3[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap3,
labels_row = sub3$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks)
sub4 <- ds.plot[(cut5+1):nrow(ds.plot),]
gap4 <- which(sub4$HH_order==1) +1
gap4 <- gap4[-length(gap4)]
heat4<-pheatmap(sub4[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap4,
labels_row = sub4$sampleID,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=T,
labels_col = weeks)
tiff(paste("Heat", target,".tiff"), width=8, height=8, unit='in', res=200)
grid.arrange(heat1[[4]],heat2[[4]],heat3[[4]],heat4[[4]],ncol=4)
dev.off()
View(sub4)
ds.plot$labels <- paste(ds.plot$season, ds.plot$seasonid, sep='_')
heat2<-pheatmap(sub2[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap2,
labels_row = sub2$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks)
sub3 <- ds.plot[(cut4+1):cut5,]
gap3 <- which(sub3$HH_order==1) +1
gap3 <- gap3[-length(gap3)]
heat3<-pheatmap(sub3[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap3,
labels_row = sub3$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks)
sub4 <- ds.plot[(cut5+1):nrow(ds.plot),]
gap4 <- which(sub4$HH_order==1) +1
gap4 <- gap4[-length(gap4)]
heat4<-pheatmap(sub4[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap4,
labels_row = sub4$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=T,
labels_col = weeks)
tiff(paste("Heat", target,".tiff"), width=8, height=8, unit='in', res=200)
grid.arrange(heat1[[4]],heat2[[4]],heat3[[4]],heat4[[4]],ncol=4)
dev.off()
ds.plot$labels <- paste(ds.plot$season, ds.plot$seasonid, sep='_')
sub1 <- ds.plot[1:cut3,]
gap1 <- which(sub1$HH_order==1) +1
gap1 <- gap1[-length(gap1)]
#First half
heat1 <- (pheatmap(sub1[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap1,
labels_row = sub1$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks))
sub2 <- ds.plot[(cut3+1):cut4,]
gap2 <- which(sub2$HH_order==1) +1
gap2 <- gap2[-length(gap2)]
heat2<-pheatmap(sub2[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap2,
labels_row = sub2$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks)
sub3 <- ds.plot[(cut4+1):cut5,]
gap3 <- which(sub3$HH_order==1) +1
gap3 <- gap3[-length(gap3)]
heat3<-pheatmap(sub3[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap3,
labels_row = sub3$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks)
sub4 <- ds.plot[(cut5+1):nrow(ds.plot),]
gap4 <- which(sub4$HH_order==1) +1
gap4 <- gap4[-length(gap4)]
heat4<-pheatmap(sub4[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap4,
labels_row = sub4$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=T,
labels_col = weeks)
tiff(paste("Heat", target,".tiff"), width=8, height=8, unit='in', res=200)
grid.arrange(heat1[[4]],heat2[[4]],heat3[[4]],heat4[[4]],ncol=4)
dev.off()
cut4=95
ds1 <- ds1 %>%
group_by(season, seasonid, seasonhh) %>%
mutate(sampleID=cur_group_id()) %>%
ungroup() %>%
group_by(season,seasonhh) %>%
mutate(house=group_indices()) %>%
ungroup() %>%
arrange(season,seasonhh, seasonid)
ds.plot <- dcast(ds1, house+sampleID + season + seasonid + seasonhh +HH_order~time, value.var = target)
ds.plot$labels <- paste(ds.plot$season, ds.plot$seasonid, sep='_')
sub1 <- ds.plot[1:cut3,]
gap1 <- which(sub1$HH_order==1) +1
gap1 <- gap1[-length(gap1)]
#First half
heat1 <- (pheatmap(sub1[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap1,
labels_row = sub1$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks))
sub2 <- ds.plot[(cut3+1):cut4,]
gap2 <- which(sub2$HH_order==1) +1
gap2 <- gap2[-length(gap2)]
heat2<-pheatmap(sub2[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap2,
labels_row = sub2$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks)
sub3 <- ds.plot[(cut4+1):cut5,]
gap3 <- which(sub3$HH_order==1) +1
gap3 <- gap3[-length(gap3)]
heat3<-pheatmap(sub3[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap3,
labels_row = sub3$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=F,
labels_col = weeks)
sub4 <- ds.plot[(cut5+1):nrow(ds.plot),]
gap4 <- which(sub4$HH_order==1) +1
gap4 <- gap4[-length(gap4)]
heat4<-pheatmap(sub4[,c('1','2','3','4','5','6')],
cluster_cols = F,
cluster_rows = F,
gaps_row = gap4,
labels_row = sub4$labels,
cellwidth = 9,
cellheight = 9,
color=colorRampPalette(c('red4','red','darkorange','orange','gold','lightgoldenrod1','white','white'))(length(breakslist)),
breaks=breakslist,
legend=T,
labels_col = weeks)
tiff(paste("Heat", target,".tiff"), width=8, height=8, unit='in', res=200)
grid.arrange(heat1[[4]],heat2[[4]],heat3[[4]],heat4[[4]],ncol=4)
dev.off()
c1.m.m <- melt(c1.m[,c('Target','ID','Sample','ct_pos2','Household') ],
id.vars=c('Target','ID','Sample','Household'))
c1.m.c <- dcast(c1.m.m, ID + Household + Sample  ~Target, fun.aggregate = min, fill=999)
#N people
N.id <- length(unique(c1.m.c$ID))
N.id
#N households
N.hh<- length(unique(c1.m.c$Household))
N.hh
#N samples
nrow(c1.m.c)
#length(unique(c1.m.c$Sample[c1.m$Target=='piab']))
#length(unique(c1.m.c$Sample[c1.m$Target=='lyta']))
#N positive
sum(c1.m.c$piab<40 )
sum(c1.m.c$piab<40  &c1.m.c$lyta>=40)
sum(c1.m.c$piab<40  &c1.m.c$lyta<40)
#% positive
sum(c1.m.c$piab<40 )/nrow(c1.m.c)
#N positive lytA
sum(c1.m.c$lyta<40 )
sum(c1.m.c$lyta<40 )/nrow(c1.m.c)
#Count N people with piaB positives by IDs
c1.m.spl.id <- split(c1.m.c, c1.m.c$ID)
N_pos_people <- sum(sapply(c1.m.spl.id, function(x){
min(x$piab) <40
}
))
N_pos_people
N_pos_people/N.id
#Count N HH with piab positives by IDs
c1.m.spl.id <- split(c1.m.c, c1.m.c$Household)
n_pos_hh <- sum(sapply(c1.m.spl.id, function(x){
min(x$piab) <40
}
))
n_pos_hh
n_pos_hh/N.hh
## Ave age
age1 <- read_excel('./Data/confidential/AGE Scope Participants samples pick-up 06-15-2021.xlsx', skip=1)
names(age1)[1] <- 'ID'
age1 <- age1[ which(age1$ID %in% unique(c1.m.c$ID)),]
mean(age1$AGE)
range(age1$AGE)
